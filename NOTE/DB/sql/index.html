
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="人生苦短，纵情燃烧">
      
      
        <meta name="author" content="Kailqq">
      
      
        <link rel="canonical" href="https://note.kailqq.cc/NOTE/DB/sql/">
      
      
        <link rel="prev" href="../lec2/">
      
      
        <link rel="next" href="../ER/">
      
      
      <link rel="icon" href="../../../static/images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>SQL - 71229号港湾</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M156.6%20384.9%20125.7%20354c-8.5-8.5-11.5-20.8-7.7-32.2%203-8.9%207-20.5%2011.8-33.8H24c-8.6%200-16.6-4.6-20.9-12.1s-4.2-16.7.2-24.1l52.5-88.5c13-21.9%2036.5-35.3%2061.9-35.3H200c2.4-4%204.8-7.7%207.2-11.3C289.1-4.1%20411.1-8.1%20483.9%205.3c11.6%202.1%2020.6%2011.2%2022.8%2022.8%2013.4%2072.9%209.3%20194.8-111.4%20276.7-3.5%202.4-7.3%204.8-11.3%207.2v82.3c0%2025.4-13.4%2049-35.3%2061.9l-88.5%2052.5c-7.4%204.4-16.6%204.5-24.1.2S224%20496.7%20224%20488V380.8c-14.1%204.9-26.4%208.9-35.7%2011.9-11.2%203.6-23.4.5-31.8-7.8zM384%20168a40%2040%200%201%200%200-80%2040%2040%200%201%200%200%2080%22/%3E%3C/svg%3E');--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M373.5%2027.1C388.5%209.9%20410.2%200%20433%200c43.6%200%2079%2035.4%2079%2079%200%2022.8-9.9%2044.6-27.1%2059.6L277.7%20319l-10.3-10.3-64-64-10.4-10.4zM170.3%20256.9l10.4%2010.4%2064%2064%2010.4%2010.4-19.2%2083.4c-3.9%2017.1-16.9%2030.7-33.8%2035.4L24.3%20510.3l95.4-95.4c2.6.7%205.4%201.1%208.3%201.1%2017.7%200%2032-14.3%2032-32s-14.3-32-32-32-32%2014.3-32%2032c0%202.9.4%205.6%201.1%208.3L1.7%20487.6%2051.5%20310c4.7-16.9%2018.3-29.9%2035.4-33.8l83.4-19.2z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M40%2048c-13.3%200-24%2010.7-24%2024v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24V72c0-13.3-10.7-24-24-24zm152%2016c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zm0%20160c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zm0%20160c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h288c17.7%200%2032-14.3%2032-32s-14.3-32-32-32zM16%20232v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24v-48c0-13.3-10.7-24-24-24H40c-13.3%200-24%2010.7-24%2024m24%20136c-13.3%200-24%2010.7-24%2024v48c0%2013.3%2010.7%2024%2024%2024h48c13.3%200%2024-10.7%2024-24v-48c0-13.3-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20384%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M272%20384c9.6-31.9%2029.5-59.1%2049.2-86.2%205.2-7.1%2010.4-14.2%2015.4-21.4%2019.8-28.5%2031.4-63%2031.4-100.3C368%2078.8%20289.2%200%20192%200S16%2078.8%2016%20176c0%2037.3%2011.6%2071.9%2031.4%20100.3%205%207.2%2010.2%2014.3%2015.4%2021.4%2019.8%2027.1%2039.7%2054.4%2049.2%2086.2h160zm-80%20128c44.2%200%2080-35.8%2080-80v-16H112v16c0%2044.2%2035.8%2080%2080%2080m-80-336c0%208.8-7.2%2016-16%2016s-16-7.2-16-16c0-61.9%2050.1-112%20112-112%208.8%200%2016%207.2%2016%2016s-7.2%2016-16%2016c-44.2%200-80%2035.8-80%2080%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M438.6%20105.4c12.5%2012.5%2012.5%2032.8%200%2045.3l-256%20256c-12.5%2012.5-32.8%2012.5-45.3%200l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200L160%20338.7l233.4-233.3c12.5-12.5%2032.8-12.5%2045.3%200z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%2032c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v208c0%208.8-7.2%2016-16%2016s-16-7.2-16-16V64c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v272c0%201.5%200%203.1.1%204.6L67.6%20283c-16-15.2-41.3-14.6-56.6%201.4s-14.6%2041.3%201.4%2056.6l112.4%20107c43.1%2041.1%20100.4%2064%20160%2064H304c97.2%200%20176-78.8%20176-176V128c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v112c0%208.8-7.2%2016-16%2016s-16-7.2-16-16V64c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v176c0%208.8-7.2%2016-16%2016s-16-7.2-16-16z%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%2032c14.2%200%2027.3%207.5%2034.5%2019.8l216%20368c7.3%2012.4%207.3%2027.7.2%2040.1S486.3%20480%20472%20480H40c-14.3%200-27.6-7.7-34.7-20.1s-7-27.8.2-40.1l216-368C228.7%2039.5%20241.8%2032%20256%2032m0%20128c-13.3%200-24%2010.7-24%2024v112c0%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24V184c0-13.3-10.7-24-24-24m32%20224a32%2032%200%201%200-64%200%2032%2032%200%201%200%2064%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%203c4.97%200%209%203.58%209%208s-6%2010-9%2010-9-5.58-9-10%204.03-8%209-8m-1.69%207.93C9.29%209.29%207.47%208.58%206.25%209.34s-1.38%202.71-.36%204.35c1.03%201.64%202.85%202.35%204.07%201.59%201.22-.78%201.37-2.71.35-4.35m3.38%200c-1.02%201.64-.87%203.57.35%204.35%201.22.76%203.04.05%204.07-1.59%201.02-1.64.86-3.59-.36-4.35s-3.04-.05-4.06%201.59M12%2017.75c-2%200-2.5-.75-2.5-.75%200%20.03.5%202%202.5%202s2.5-2%202.5-2-.5.75-2.5.75%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%2032c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v11.5c0%2049.9-60.3%2074.9-95.6%2039.6l-8.2-8.1C107.7%2062.5%2087.5%2062.5%2075%2075s-12.5%2032.8%200%2045.3l8.2%208.2c35.2%2035.2%2010.2%2095.5-39.7%2095.5H32c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h11.5c49.9%200%2074.9%2060.3%2039.6%2095.6l-8.1%208.2c-12.5%2012.5-12.5%2032.8%200%2045.3s32.8%2012.5%2045.3%200l8.2-8.2c35.3-35.3%2095.6-10.3%2095.6%2039.6V480c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-11.5c0-49.9%2060.3-74.9%2095.6-39.6l8.2%208.2c12.5%2012.5%2032.8%2012.5%2045.3%200s12.5-32.8%200-45.3l-8.2-8.2c-35.3-35.3-10.3-95.6%2039.6-95.6h11.5c17.7%200%2032-14.3%2032-32s-14.3-32-32-32h-11.5c-49.9%200-74.9-60.3-39.6-95.6l8.2-8.2c12.5-12.5%2012.5-32.8%200-45.3s-32.8-12.5-45.3%200l-8.2%208.2C348.3%20118.4%20288%2093.4%20288%2043.5zM176%20224a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m128%2056a24%2024%200%201%201%200%2048%2024%2024%200%201%201%200-48%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M320%200c17.7%200%2032%2014.3%2032%2032v64h120c39.8%200%2072%2032.2%2072%2072v272c0%2039.8-32.2%2072-72%2072H168c-39.8%200-72-32.2-72-72V168c0-39.8%2032.2-72%2072-72h120V32c0-17.7%2014.3-32%2032-32M208%20384c-8.8%200-16%207.2-16%2016s7.2%2016%2016%2016h32c8.8%200%2016-7.2%2016-16s-7.2-16-16-16zm96%200c-8.8%200-16%207.2-16%2016s7.2%2016%2016%2016h32c8.8%200%2016-7.2%2016-16s-7.2-16-16-16zm96%200c-8.8%200-16%207.2-16%2016s7.2%2016%2016%2016h32c8.8%200%2016-7.2%2016-16s-7.2-16-16-16zM264%20256a40%2040%200%201%200-80%200%2040%2040%200%201%200%2080%200m152%2040a40%2040%200%201%200%200-80%2040%2040%200%201%200%200%2080M48%20224h16v192H48c-26.5%200-48-21.5-48-48v-96c0-26.5%2021.5-48%2048-48m544%200c26.5%200%2048%2021.5%2048%2048v96c0%2026.5-21.5%2048-48%2048h-16V224z%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M192%2032c0-17.7%2014.3-32%2032-32h128c17.7%200%2032%2014.3%2032%2032v32h48c26.5%200%2048%2021.5%2048%2048v128l44.4%2014.8c23.1%207.7%2029.5%2037.5%2011.5%2053.9l-101%2092.6c-16.2%209.4-34.7%2015.1-50.9%2015.1-19.6%200-40.8-7.7-59.2-20.3-22.1-15.5-51.6-15.5-73.7%200-17.1%2011.8-38%2020.3-59.2%2020.3-16.2%200-34.7-5.7-50.9-15.1L40%20308.7c-18-16.5-11.6-46.2%2011.5-53.9L96%20240V112c0-26.5%2021.5-48%2048-48h48zm-32%20186.7%20107.8-35.9c13.1-4.4%2027.3-4.4%2040.5%200L416%20218.7V128H160zm146.5%20203.2c22.5%2015.5%2050%2026.1%2077.5%2026.1%2026.9%200%2055.4-10.8%2077.4-26.1%2011.9-8.5%2028.1-7.8%2039.2%201.7%2014.4%2011.9%2032.5%2021%2050.6%2025.2%2017.2%204%2027.9%2021.2%2023.9%2038.4s-21.2%2027.9-38.4%2023.9c-24.5-5.7-44.9-16.5-58.2-25-29%2015.6-61.5%2025.9-94.5%2025.9-31.9%200-60.6-9.9-80.4-18.9-5.8-2.7-11.1-5.3-15.6-7.7-4.5%202.4-9.7%205.1-15.6%207.7-19.8%209-48.5%2018.9-80.4%2018.9-33%200-65.5-10.3-94.5-25.8-13.4%208.4-33.7%2019.3-58.2%2025-17.2%204-34.4-6.7-38.4-23.9s6.7-34.4%2023.9-38.4c18.1-4.2%2036.2-13.3%2050.6-25.2%2011.1-9.4%2027.3-10.1%2039.2-1.7%2022.1%2015.2%2050.5%2026%2077.4%2026%2027.5%200%2055-10.6%2077.5-26.1%2011.1-7.9%2025.9-7.9%2037%200%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M579.8%20267.7c56.5-56.5%2056.5-148%200-204.5-50-50-128.8-56.5-186.3-15.4l-1.6%201.1c-14.4%2010.3-17.7%2030.3-7.4%2044.6s30.3%2017.7%2044.6%207.4l1.6-1.1c32.1-22.9%2076-19.3%20103.8%208.6%2031.5%2031.5%2031.5%2082.5%200%20114L422.3%20334.8c-31.5%2031.5-82.5%2031.5-114%200-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4%206.9-34.4-7.4-44.6s-34.4-6.9-44.6%207.4l-1.1%201.6C206.5%20251.2%20213%20330%20263%20380c56.5%2056.5%20148%2056.5%20204.5%200zM60.2%20244.3c-56.5%2056.5-56.5%20148%200%20204.5%2050%2050%20128.8%2056.5%20186.3%2015.4l1.6-1.1c14.4-10.3%2017.7-30.3%207.4-44.6s-30.3-17.7-44.6-7.4l-1.6%201.1c-32.1%2022.9-76%2019.3-103.8-8.6C74%20372%2074%20321%20105.5%20289.5l112.2-112.3c31.5-31.5%2082.5-31.5%20114%200%2027.9%2027.9%2031.5%2071.8%208.6%20103.9l-1.1%201.6c-10.3%2014.4-6.9%2034.4%207.4%2044.6s34.4%206.9%2044.6-7.4l1.1-1.6C433.5%20260.8%20427%20182%20377%20132c-56.5-56.5-148-56.5-204.5%200z%22/%3E%3C/svg%3E');}</style>



  
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
  
  <style>:root{.md-tag.md-tag--default-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M0%2080v149.5c0%2017%206.7%2033.3%2018.7%2045.3l176%20176c25%2025%2065.5%2025%2090.5%200l133.5-133.5c25-25%2025-65.5%200-90.5l-176-176c-12-12-28.3-18.7-45.3-18.7L48%2032C21.5%2032%200%2053.5%200%2080m112%2032a32%2032%200%201%201%200%2064%2032%2032%200%201%201%200-64%22/%3E%3C/svg%3E');}.md-tag.md-tag--hardware-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M176%2024c0-13.3-10.7-24-24-24s-24%2010.7-24%2024v40c-35.3%200-64%2028.7-64%2064H24c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h40v56H24c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h40v56H24c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h40c0%2035.3%2028.7%2064%2064%2064v40c0%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24v-40h56v40c0%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24v-40h56v40c0%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24v-40c35.3%200%2064-28.7%2064-64h40c13.3%200%2024-10.7%2024-24s-10.7-24-24-24h-40v-56h40c13.3%200%2024-10.7%2024-24s-10.7-24-24-24h-40v-56h40c13.3%200%2024-10.7%2024-24s-10.7-24-24-24h-40c0-35.3-28.7-64-64-64V24c0-13.3-10.7-24-24-24s-24%2010.7-24%2024v40h-56V24c0-13.3-10.7-24-24-24s-24%2010.7-24%2024v40h-56zm-16%20104h192c17.7%200%2032%2014.3%2032%2032v192c0%2017.7-14.3%2032-32%2032H160c-17.7%200-32-14.3-32-32V160c0-17.7%2014.3-32%2032-32m192%2032H160v192h192z%22/%3E%3C/svg%3E');}.md-tag.md-tag--software-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%206.7.2%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202024%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M64%2096c0-35.3%2028.7-64%2064-64h384c35.3%200%2064%2028.7%2064%2064v256h-64V96H128v256H64zM0%20403.2C0%20392.6%208.6%20384%2019.2%20384h601.6c10.6%200%2019.2%208.6%2019.2%2019.2%200%2042.4-34.4%2076.8-76.8%2076.8H76.8C34.4%20480%200%20445.6%200%20403.2M281%20209l-31%2031%2031%2031c9.4%209.4%209.4%2024.6%200%2033.9s-24.6%209.4-33.9%200l-48-48c-9.4-9.4-9.4-24.6%200-33.9l48-48c9.4-9.4%2024.6-9.4%2033.9%200s9.4%2024.6%200%2033.9zm112-34%2048%2048c9.4%209.4%209.4%2024.6%200%2033.9l-48%2048c-9.4%209.4-24.6%209.4-33.9%200s-9.4-24.6%200-33.9l31-31-31-31c-9.4-9.4-9.4-24.6%200-33.9s24.6-9.4%2033.9%200z%22/%3E%3C/svg%3E');}}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/print-site.css">
    
      <link rel="stylesheet" href="../../../css/print-site-material.css">
    
      <link rel="stylesheet" href="../../../css/timeline.css">
    
      <link rel="stylesheet" href="../../../css/katex.min.css">
    
      <link rel="stylesheet" href="../../../css/cards.css">
    
      <link rel="stylesheet" href="../../../css/card.css">
    
      <link rel="stylesheet" href="../../../css/newfonts.css">
    
      <link rel="stylesheet" href="../../../css/newadmonitions.css">
    
      <link rel="stylesheet" href="../../../css/newcolor.css">
    
      <link rel="stylesheet" href="../../../css/changelogs.css">
    
      <link rel="stylesheet" href="../../../css/tableandsize.css">
    
      <link rel="stylesheet" href="../../../css/flink.css">
    
      <link rel="stylesheet" href="../../../css/float_card.css">
    
      <link rel="stylesheet" href="../../../css/fdtoc.css">
    
      <link rel="stylesheet" href="../../../css/tocindex.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="theme" data-md-color-primary="custom" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sql" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="71229号港湾" class="md-header__button md-logo" aria-label="71229号港湾" data-md-component="logo">
      
  <img src="../../../static/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            71229号港湾
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SQL
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="theme" data-md-color-primary="custom" data-md-color-accent="pink"  aria-label="万籁俱寂"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="万籁俱寂" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="custom"  aria-label="萧瑟凌晨"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="萧瑟凌晨" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: no-preference)" data-md-color-scheme="simple" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="烈日灼心"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="烈日灼心" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/kailqq/kailqq.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    𝓚𝓪𝓲𝓵𝓺𝓺
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  📚 学习笔记

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../friends/" class="md-tabs__link">
        
  
  
    
  
  🚀 友情链接

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="71229号港湾" class="md-nav__button md-logo" aria-label="71229号港湾" data-md-component="logo">
      
  <img src="../../../static/images/logo.png" alt="logo">

    </a>
    71229号港湾
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kailqq/kailqq.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    𝓚𝓪𝓲𝓵𝓺𝓺
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    📚 学习笔记
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            📚 学习笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    🎓 课程笔记
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            🎓 课程笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    数据库系统
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            数据库系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lec1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    介绍
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lec2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关系模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    SQL
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    SQL
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-definition-language" class="md-nav__link">
    <span class="md-ellipsis">
      Data Definition Language
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Definition Language">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-types" class="md-nav__link">
    <span class="md-ellipsis">
      Domain types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-table" class="md-nav__link">
    <span class="md-ellipsis">
      Create Table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create Table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integrity-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Integrity Constraints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop-and-alter-table" class="md-nav__link">
    <span class="md-ellipsis">
      DROP and ALTER Table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DROP and ALTER Table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drop-table" class="md-nav__link">
    <span class="md-ellipsis">
      Drop Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alter-table" class="md-nav__link">
    <span class="md-ellipsis">
      Alter Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-index" class="md-nav__link">
    <span class="md-ellipsis">
      Create Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-select-clause" class="md-nav__link">
    <span class="md-ellipsis">
      The select clause
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-where-clause" class="md-nav__link">
    <span class="md-ellipsis">
      The where clause
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-from-clause" class="md-nav__link">
    <span class="md-ellipsis">
      The from clause
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-rename-operation" class="md-nav__link">
    <span class="md-ellipsis">
      The rename operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-operation" class="md-nav__link">
    <span class="md-ellipsis">
      String operation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="String operation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fuzzy-matching" class="md-nav__link">
    <span class="md-ellipsis">
      fuzzy matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-string-operations" class="md-nav__link">
    <span class="md-ellipsis">
      other string operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ordering-the-display-of-results" class="md-nav__link">
    <span class="md-ellipsis">
      Ordering the display of results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-operations" class="md-nav__link">
    <span class="md-ellipsis">
      SET Operations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregate-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregate Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregate Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-by" class="md-nav__link">
    <span class="md-ellipsis">
      Group By
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" class="md-nav__link">
    <span class="md-ellipsis">
      Having
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-of-select" class="md-nav__link">
    <span class="md-ellipsis">
      Summary of Select
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#null-values" class="md-nav__link">
    <span class="md-ellipsis">
      Null Values
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Null Values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#null-values-in-aggregate-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Null Values in Aggregate Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nested-subqueries" class="md-nav__link">
    <span class="md-ellipsis">
      Nested Subqueries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nested Subqueries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-structure_1" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Set Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-for-empty-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Test for Empty Relations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-for-absence-of-duplicate-tuples" class="md-nav__link">
    <span class="md-ellipsis">
      Test for Absence of Duplicate Tuples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#views" class="md-nav__link">
    <span class="md-ellipsis">
      Views
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Views">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-view" class="md-nav__link">
    <span class="md-ellipsis">
      Create View
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop-view" class="md-nav__link">
    <span class="md-ellipsis">
      Drop View
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derived-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Derived Relations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Derived Relations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-clause" class="md-nav__link">
    <span class="md-ellipsis">
      With Clause
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modification-of-database" class="md-nav__link">
    <span class="md-ellipsis">
      Modification of Database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modification of Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Deletion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insertion" class="md-nav__link">
    <span class="md-ellipsis">
      Insertion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updates" class="md-nav__link">
    <span class="md-ellipsis">
      Updates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Updates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-statement-for-conditional-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Case Statement for Conditional Updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-of-view" class="md-nav__link">
    <span class="md-ellipsis">
      Update of view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-of-update-on-view" class="md-nav__link">
    <span class="md-ellipsis">
      Summary of update on view
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joined-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Joined Relations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Joined Relations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inner-join" class="md-nav__link">
    <span class="md-ellipsis">
      INNER JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#left-join-left-outer-join" class="md-nav__link">
    <span class="md-ellipsis">
      LEFT JOIN (LEFT OUTER JOIN)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#right-join-right-outer-join" class="md-nav__link">
    <span class="md-ellipsis">
      RIGHT JOIN (RIGHT OUTER JOIN)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-outer-join" class="md-nav__link">
    <span class="md-ellipsis">
      FULL OUTER JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-join" class="md-nav__link">
    <span class="md-ellipsis">
      CROSS JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#self-join" class="md-nav__link">
    <span class="md-ellipsis">
      SELF JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-condition" class="md-nav__link">
    <span class="md-ellipsis">
      JOIN condition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JOIN condition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#on" class="md-nav__link">
    <span class="md-ellipsis">
      ON
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using" class="md-nav__link">
    <span class="md-ellipsis">
      USING
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      JOIN performance optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced SQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced SQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-data-types-and-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      SQL Data Types and Schemas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL Data Types and Schemas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-defined-types" class="md-nav__link">
    <span class="md-ellipsis">
      User-defined types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-new-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Create new domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#large-object-types" class="md-nav__link">
    <span class="md-ellipsis">
      Large object types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrity-constraints_1" class="md-nav__link">
    <span class="md-ellipsis">
      Integrity Constraints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrity Constraints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referential-integrity" class="md-nav__link">
    <span class="md-ellipsis">
      Referential Integrity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assertions" class="md-nav__link">
    <span class="md-ellipsis">
      Assertions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triggers" class="md-nav__link">
    <span class="md-ellipsis">
      Triggers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forms-of-authorization-on-parts-of-the-database" class="md-nav__link">
    <span class="md-ellipsis">
      Forms of Authorization on Parts of the Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forms-of-authorization-to-modify-the-database-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Forms of Authorization to Modify the Database Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#granting-of-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      Granting of Privileges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grant-statement" class="md-nav__link">
    <span class="md-ellipsis">
      Grant Statement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roles" class="md-nav__link">
    <span class="md-ellipsis">
      Roles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#revoking-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Revoking Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-trails" class="md-nav__link">
    <span class="md-ellipsis">
      Audit Trails
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedded-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Embedded SQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Embedded SQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    <span class="md-ellipsis">
      SELECT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      Update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic SQL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odbc-and-jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      ODBC and JDBC
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ER/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ER模型
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lec7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关系数据库设计
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lec8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    内存管理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../indexing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    查询处理
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    查询优化
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    事务
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    并发控制
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../recovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    恢复
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../CO/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    计算机组成与设计
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../ADS/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    高级数据结构与算法分析
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../Arch/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    计算机体系结构
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../DataMarket/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    数据要素市场
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    🔬 数学与物理
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            🔬 数学与物理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../LA/linear-algebra/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    线性代数 (LINEAR-ALGEBRA)
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../Probability/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    概率论
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../MA/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    数学分析
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../Physics/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    普通物理学二
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../CS/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    💻 自学笔记
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4" id="__nav_2_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            💻 自学笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../CS/TMS/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Missing Semester (TMS)
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../CS/GIT/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Git 版本控制
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../CS/Verilog/verilog/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    编程语言
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../CS/CV/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    计算机视觉 (Computer Vision)
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../Language/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    语言学习
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    🛡️ 安全与竞赛
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            🛡️ 安全与竞赛
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../CTF/CTF/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    CTF 竞赛
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../friends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    🚀 友情链接
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-definition-language" class="md-nav__link">
    <span class="md-ellipsis">
      Data Definition Language
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Definition Language">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-types" class="md-nav__link">
    <span class="md-ellipsis">
      Domain types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-table" class="md-nav__link">
    <span class="md-ellipsis">
      Create Table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create Table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integrity-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Integrity Constraints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop-and-alter-table" class="md-nav__link">
    <span class="md-ellipsis">
      DROP and ALTER Table
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DROP and ALTER Table">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drop-table" class="md-nav__link">
    <span class="md-ellipsis">
      Drop Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alter-table" class="md-nav__link">
    <span class="md-ellipsis">
      Alter Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-index" class="md-nav__link">
    <span class="md-ellipsis">
      Create Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-select-clause" class="md-nav__link">
    <span class="md-ellipsis">
      The select clause
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-where-clause" class="md-nav__link">
    <span class="md-ellipsis">
      The where clause
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-from-clause" class="md-nav__link">
    <span class="md-ellipsis">
      The from clause
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-rename-operation" class="md-nav__link">
    <span class="md-ellipsis">
      The rename operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#string-operation" class="md-nav__link">
    <span class="md-ellipsis">
      String operation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="String operation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fuzzy-matching" class="md-nav__link">
    <span class="md-ellipsis">
      fuzzy matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-string-operations" class="md-nav__link">
    <span class="md-ellipsis">
      other string operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ordering-the-display-of-results" class="md-nav__link">
    <span class="md-ellipsis">
      Ordering the display of results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-operations" class="md-nav__link">
    <span class="md-ellipsis">
      SET Operations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregate-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregate Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregate Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-by" class="md-nav__link">
    <span class="md-ellipsis">
      Group By
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" class="md-nav__link">
    <span class="md-ellipsis">
      Having
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-of-select" class="md-nav__link">
    <span class="md-ellipsis">
      Summary of Select
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#null-values" class="md-nav__link">
    <span class="md-ellipsis">
      Null Values
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Null Values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#null-values-in-aggregate-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Null Values in Aggregate Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nested-subqueries" class="md-nav__link">
    <span class="md-ellipsis">
      Nested Subqueries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nested Subqueries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-structure_1" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Set Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-for-empty-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Test for Empty Relations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-for-absence-of-duplicate-tuples" class="md-nav__link">
    <span class="md-ellipsis">
      Test for Absence of Duplicate Tuples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#views" class="md-nav__link">
    <span class="md-ellipsis">
      Views
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Views">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-view" class="md-nav__link">
    <span class="md-ellipsis">
      Create View
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop-view" class="md-nav__link">
    <span class="md-ellipsis">
      Drop View
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derived-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Derived Relations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Derived Relations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-clause" class="md-nav__link">
    <span class="md-ellipsis">
      With Clause
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modification-of-database" class="md-nav__link">
    <span class="md-ellipsis">
      Modification of Database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modification of Database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Deletion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insertion" class="md-nav__link">
    <span class="md-ellipsis">
      Insertion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updates" class="md-nav__link">
    <span class="md-ellipsis">
      Updates
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Updates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-statement-for-conditional-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Case Statement for Conditional Updates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-of-view" class="md-nav__link">
    <span class="md-ellipsis">
      Update of view
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-of-update-on-view" class="md-nav__link">
    <span class="md-ellipsis">
      Summary of update on view
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joined-relations" class="md-nav__link">
    <span class="md-ellipsis">
      Joined Relations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Joined Relations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inner-join" class="md-nav__link">
    <span class="md-ellipsis">
      INNER JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#left-join-left-outer-join" class="md-nav__link">
    <span class="md-ellipsis">
      LEFT JOIN (LEFT OUTER JOIN)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#right-join-right-outer-join" class="md-nav__link">
    <span class="md-ellipsis">
      RIGHT JOIN (RIGHT OUTER JOIN)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-outer-join" class="md-nav__link">
    <span class="md-ellipsis">
      FULL OUTER JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-join" class="md-nav__link">
    <span class="md-ellipsis">
      CROSS JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#self-join" class="md-nav__link">
    <span class="md-ellipsis">
      SELF JOIN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-condition" class="md-nav__link">
    <span class="md-ellipsis">
      JOIN condition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JOIN condition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#on" class="md-nav__link">
    <span class="md-ellipsis">
      ON
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using" class="md-nav__link">
    <span class="md-ellipsis">
      USING
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      JOIN performance optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced SQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced SQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-data-types-and-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      SQL Data Types and Schemas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQL Data Types and Schemas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-defined-types" class="md-nav__link">
    <span class="md-ellipsis">
      User-defined types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-new-domain" class="md-nav__link">
    <span class="md-ellipsis">
      Create new domain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#large-object-types" class="md-nav__link">
    <span class="md-ellipsis">
      Large object types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integrity-constraints_1" class="md-nav__link">
    <span class="md-ellipsis">
      Integrity Constraints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integrity Constraints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Domain Constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referential-integrity" class="md-nav__link">
    <span class="md-ellipsis">
      Referential Integrity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assertions" class="md-nav__link">
    <span class="md-ellipsis">
      Assertions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#triggers" class="md-nav__link">
    <span class="md-ellipsis">
      Triggers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      Security
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forms-of-authorization-on-parts-of-the-database" class="md-nav__link">
    <span class="md-ellipsis">
      Forms of Authorization on Parts of the Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forms-of-authorization-to-modify-the-database-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Forms of Authorization to Modify the Database Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#granting-of-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      Granting of Privileges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grant-statement" class="md-nav__link">
    <span class="md-ellipsis">
      Grant Statement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roles" class="md-nav__link">
    <span class="md-ellipsis">
      Roles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#revoking-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Revoking Authorization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-trails" class="md-nav__link">
    <span class="md-ellipsis">
      Audit Trails
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedded-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Embedded SQL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Embedded SQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select" class="md-nav__link">
    <span class="md-ellipsis">
      SELECT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      Update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic SQL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odbc-and-jdbc" class="md-nav__link">
    <span class="md-ellipsis">
      ODBC and JDBC
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="sql">SQL<a class="headerlink" href="#sql" title="Permanent link">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"/></svg></span> 约 10827 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"/></svg></span> 773 行代码 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3m12.96-10.71-2.75 3.54-1.96-2.36L8.5 15h11z"/></svg></span> 5 张图片 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"/></svg></span> 预计阅读时间 47 分钟</p>
</div>
<p>SQL includes several parts:</p>
<ul>
<li>DDL: Data Definition Language</li>
<li>DML: Data Manipulation Language</li>
<li>DQL: Data Query Language</li>
<li>DCL: Data Control Language</li>
</ul>
<h2 id="data-definition-language">Data Definition Language<a class="headerlink" href="#data-definition-language" title="Permanent link">&para;</a></h2>
<p>The main functions of DDL contain:</p>
<ul>
<li>Define the <em>schema</em> for each relation</li>
<li>Define the <em>domain</em> of values associated with each attribute</li>
<li>Define the <em>integrity constraints</em></li>
<li>Define the <em>physical storage structure</em> of each relation on disk</li>
<li>Define the <em>indices</em> to be maintained for each relations</li>
<li>Define the <em>view</em> on relations</li>
</ul>
<p>For example,if we want to define a table named <code>branch</code></p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="n">branch_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="n">branch_city</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="n">assets</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">);</span>
</span></code></pre></div>
<p>or</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="n">branch_name</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="n">branch_city</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="n">assets</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">branch_name</span><span class="p">)</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="p">);</span>
</span></code></pre></div>
<h3 id="domain-types">Domain types<a class="headerlink" href="#domain-types" title="Permanent link">&para;</a></h3>
<ul>
<li><code>CHAR(n)</code>: fixed length character string,with user-specified length</li>
<li><code>VARCHAR(n)</code>: variable length character string,with user-specified maximum length</li>
<li><code>INT</code> or <code>INTEGER</code>: integer number</li>
<li><code>SMALLINT</code>: small integer number</li>
<li><code>NUMERIC(p, d)</code>: fixed point number with user-specified precision and scale(总共为p位有效位,其中小数点后有d位)</li>
<li><code>FLOAT(n)</code>: floating point number with user-specified precision,if <code>n</code> is omitted,the precision is 24</li>
<li><code>REAL</code>: floating point number with user-specified precision,such as 3.14，<code>REAL</code> is equivalent to <code>FLOAT(24)</code></li>
<li><code>DOUBLE</code> or <code>DOUBLE PRECISION</code>: double precision floating point number</li>
<li><code>NULL</code>: no value</li>
<li><code>DATE</code>: date in the format YYYY-MM-DD,such as 2025-03-01</li>
<li><code>TIME</code>: time in the format HH:MM:SS,such as 12:00:00</li>
<li><code>TIMESTAMP</code>: date and time in the format YYYY-MM-DD HH:MM:SS,such as 2025-03-01 12:00:00</li>
</ul>
<p>SQL provides various functions for data manipulation and type conversion, though the implementation may vary across different database systems. Here are some examples:</p>
<ul>
<li>
<p>String functions:</p>
<ul>
<li><code>CHAR(n)</code>: Convert ASCII code n to character,in Oracle,it is <code>CHR(n)</code></li>
<li><code>SUBSTRING(str, start, length)</code>: Extract substring from position start with given length,in Oracle,it is <code>SUBSTR(str, start, length)</code></li>
<li><code>LEN(str)</code>: Get length of string,in Oracle,it is <code>LENGTH(str)</code></li>
<li><code>GETDATE()</code>: Get current date and time,in Oracle,it is <code>SYSDATE</code></li>
<li><code>DATALENGTH(str)</code>: Get number of bytes used to represent string</li>
<li><code>CONCAT(str1, str2)</code>: Concatenate two or more strings</li>
<li><code>UPPER(str)</code>: Convert string to uppercase</li>
<li><code>LOWER(str)</code>: Convert string to lowercase</li>
<li><code>LTRIM(str)</code>: Remove leading spaces</li>
<li><code>RTRIM(str)</code>: Remove trailing spaces</li>
</ul>
</li>
<li>
<p>Numeric functions:</p>
<ul>
<li><code>ABS(n)</code>: Absolute value</li>
<li><code>ROUND(n, d)</code>: Round number to d decimal places</li>
<li><code>CEILING(n)</code>: Round up to nearest integer</li>
<li><code>FLOOR(n)</code>: Round down to nearest integer</li>
<li><code>POWER(x, y)</code>: x raised to power y</li>
<li><code>SQRT(n)</code>: Square root</li>
</ul>
</li>
<li>
<p>Date functions:</p>
<ul>
<li><code>GETDATE()</code>: Current date and time</li>
<li><code>DATEADD(part, n, date)</code>: Add n units to date</li>
<li><code>DATEDIFF(part, date1, date2)</code>: Difference between dates</li>
<li><code>YEAR(date)</code>: Extract year</li>
<li><code>MONTH(date)</code>: Extract month</li>
<li><code>DAY(date)</code>: Extract day</li>
</ul>
</li>
</ul>
<h3 id="create-table">Create Table<a class="headerlink" href="#create-table" title="Permanent link">&para;</a></h3>
<p>An SQL relation is define using the <code>CREATE TABLE</code> statement.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="n">A1</span><span class="w"> </span><span class="n">D1</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="n">A2</span><span class="w"> </span><span class="n">D2</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="p">...,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="n">An</span><span class="w"> </span><span class="n">Dn</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="p">(</span><span class="n">integrity</span><span class="w"> </span><span class="n">constraint1</span><span class="p">),</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="p">...,</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="p">(</span><span class="n">integrity</span><span class="w"> </span><span class="n">constraintk</span><span class="p">)</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>r is the name of the relation</li>
<li>Each Ai is an attribute name in the schema of relation r</li>
<li>Di is the data type of values in the domain of attribute Ai</li>
<li>integrity constrainti is a constraint on the values of attribute Ai,即完整性约束条件，例如外键约束，主键约束，唯一约束，检查约束等</li>
</ul>
<h4 id="integrity-constraints">Integrity Constraints<a class="headerlink" href="#integrity-constraints" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Not NULL</strong>: The attribute cannot be NULL
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="n">employee_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="n">first_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="n">last_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Primary Key</strong>: The attribute is the primary key of the relation
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">departments</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="n">department_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">department_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Check</strong>: The attribute must satisfy a specified condition
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="n">product_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="n">price</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Unique</strong>: The attribute must be unique
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Foreign Key</strong>: The attribute must be a foreign key of the relation
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="n">order_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">customers</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Default</strong>: The attribute must have a default value
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="n">setting_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="n">theme</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;light&#39;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Index</strong>: The attribute must be indexed
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_last_name</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">last_name</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>View</strong>: The attribute must be a view of the relation
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">employee_view</span><span class="w"> </span><span class="k">AS</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">employee_id</span><span class="p">,</span><span class="w"> </span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="n">last_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="p">;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Trigger</strong>: The attribute must be a trigger of the relation
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">update_stock</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">AFTER</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">sales</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">FOR</span><span class="w"> </span><span class="k">EACH</span><span class="w"> </span><span class="k">ROW</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="k">BEGIN</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="n">quantity</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NEW</span><span class="p">.</span><span class="n">product_id</span><span class="p">;</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="k">END</span><span class="p">;</span>
</span></code></pre></div></p>
</li>
</ul>
<blockquote>
<p>Primary key declaration on an attribute automatically ensures not null in SQL_92 onwards, needs to be explicitly stated in SQL_89 </p>
</blockquote>
<p>Another way to use integrity constraints is </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="n">employee_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">employee_id</span><span class="p">)</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="p">);</span>
</span></code></pre></div>
<h3 id="drop-and-alter-table">DROP and ALTER Table<a class="headerlink" href="#drop-and-alter-table" title="Permanent link">&para;</a></h3>
<div style="text-align: center;">
<strong style="font-size: 2em;color: red;">Be careful to use the DROP command!!!</strong>
</div>

<h4 id="drop-table">Drop Table<a class="headerlink" href="#drop-table" title="Permanent link">&para;</a></h4>
<p>the drop table statement is used to delete a table from the database.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="alter-table">Alter Table<a class="headerlink" href="#alter-table" title="Permanent link">&para;</a></h4>
<p>the alter table statement is used to modify the structure of a table.</p>
<p>the format is </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="n">data_type</span><span class="p">;</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1">-- add a new column</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="p">(</span><span class="k">column_name</span><span class="w"> </span><span class="n">data_type</span><span class="p">,</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="n">data_type</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1">-- add multiple columns</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="k">column_name</span><span class="p">;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1">-- drop a column</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">MODIFY</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="n">data_type</span><span class="p">;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="c1">-- modify the data type of a column</span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span></code></pre></div>
<h4 id="create-index">Create Index<a class="headerlink" href="#create-index" title="Permanent link">&para;</a></h4>
<p>Index is a data structure that improves the performance of database queries by allowing the database to quickly locate the data without having to scan the entire table.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">index_name</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">table_name</span><span class="p">(</span><span class="n">attribute_list</span><span class="p">);</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="c1">-- unique index</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">index_name</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">table_name</span><span class="p">(</span><span class="n">attribute_list</span><span class="p">);</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1">-- drop index</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="k">DROP</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">index_name</span><span class="p">;</span>
</span></code></pre></div>
<p>Example:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_last_name</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">last_name</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="basic-structure">Basic Structure<a class="headerlink" href="#basic-structure" title="Permanent link">&para;</a></h2>
<h3 id="the-select-clause">The select clause<a class="headerlink" href="#the-select-clause" title="Permanent link">&para;</a></h3>
<p>The select clause is used to select the data from the database.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">attribute_list</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="p">;</span>
</span></code></pre></div>
<p>such as:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="p">;</span>
</span></code></pre></div>
<p>where <code>*</code> is the wildcard character, it means all the attributes.</p>
<p>SQL allows duplicates in relations as well as in query results. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">attribute_list</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="p">;</span>
</span></code></pre></div>
<p>where <code>DISTINCT</code> is used to remove duplicates.</p>
<p>the opposite of <code>DISTINCT</code> is <code>ALL</code>, which means all the duplicates are kept.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">attribute_list</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="p">;</span>
</span></code></pre></div>
<p>By default, the select clause returns all the attributes of the relation.</p>
<h3 id="the-where-clause">The where clause<a class="headerlink" href="#the-where-clause" title="Permanent link">&para;</a></h3>
<p>The where clause is used to filter the data from the database.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">attribute_list</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">condition</span><span class="p">;</span>
</span></code></pre></div>
<p>such as:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5000</span><span class="p">;</span>
</span></code></pre></div>
<p>Comparison results can be combined using the logical connectives:</p>
<ul>
<li><code>AND</code>: Both conditions must be true</li>
<li><code>OR</code>: At least one condition must be true  </li>
<li><code>NOT</code>: Negates a condition</li>
</ul>
<p>The <code>BETWEEN</code> operator can be used to specify a range:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">loan_number</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">loan</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Downtown&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>The <code>IN</code> operator can be used to specify a list of values:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">loan_number</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">loan</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="the-from-clause">The from clause<a class="headerlink" href="#the-from-clause" title="Permanent link">&para;</a></h3>
<p>The from clause is used to specify the table from which to select the data.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">attribute_list</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">table_name1</span><span class="p">,</span><span class="w"> </span><span class="n">table_name2</span><span class="p">,</span><span class="w"> </span><span class="p">...;</span>
</span></code></pre></div>
<p>such as:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">branch_city</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span><span class="p">,</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">branch</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">branch_name</span><span class="p">;</span>
</span></code></pre></div>
<p>This will return a Cartesian product of the two tables.</p>
<p>if there are multiple tables contain the same attribute, we need to use the table name to specify the attribute.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch</span><span class="p">.</span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">branch_city</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span><span class="p">,</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">branch</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">branch_name</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="the-rename-operation">The rename operation<a class="headerlink" href="#the-rename-operation" title="Permanent link">&para;</a></h3>
<p>The rename operation is used to rename the attributes of the relation.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">attribute_list</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">new_attribute_list</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="p">;</span>
</span></code></pre></div>
<p>such as:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">branch</span><span class="p">,</span><span class="w"> </span><span class="n">branch_city</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">city</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span><span class="p">;</span>
</span></code></pre></div>
<p>Tuple variables are defined in the FROM clause via the use of the as clause. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">loan_number</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">S</span><span class="w"> </span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">loan_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">loan_number</span><span class="w"> </span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="k">AND</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
</span></code></pre></div>
<p>In SQL, the use of the <code>AS</code> keyword to define the table alias is optional. The alias can be defined directly in the <code>FROM</code> clause without using the <code>AS</code> keyword. Therefore, you can remove the <code>AS</code> keyword, and the code will still work. Here is the code without the <code>AS</code> keyword:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">loan_number</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="n">S</span><span class="w"> </span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">loan_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">loan_number</span><span class="w"> </span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="k">AND</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
</span></code></pre></div>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Find the names of all branches that have greater assets than some branch located in city Brooklyn. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">branch_name</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">S</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">assets</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">assets</span><span class="w"> </span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">branch_city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Brooklyn&#39;</span><span class="p">;</span>
</span></code></pre></div>
</div>
<h3 id="string-operation">String operation<a class="headerlink" href="#string-operation" title="Permanent link">&para;</a></h3>
<h4 id="fuzzy-matching">fuzzy matching<a class="headerlink" href="#fuzzy-matching" title="Permanent link">&para;</a></h4>
<p>SQL includes a string-matching operator for comparisons on character strings. Patterns are described using the following two special characters: </p>
<ul>
<li><code>%</code>: Matches any sequence of characters</li>
<li><code>_</code>: Matches any single character</li>
</ul>
<p>with this,we can achieve the fuzzy matching.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">last_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;S%&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>This will return all the employees whose last name starts with 'S'.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">last_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;_o%&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>This will return all the employees whose last name has 'o' as the second character.</p>
<p>It should be use in the where clause and must be used in conjunction with the <code>LIKE</code> operator.</p>
<h4 id="other-string-operations">other string operations<a class="headerlink" href="#other-string-operations" title="Permanent link">&para;</a></h4>
<p>SQL provides the <code>||</code> operator to concatenate strings.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;World&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>This will return 'Hello World'.</p>
<p>Converting string from upper case to lower case:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">LOWER</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="c1">-- output: hello</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">UPPER</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="c1">-- output: HELLO</span>
</span></code></pre></div>
<h3 id="ordering-the-display-of-results">Ordering the display of results<a class="headerlink" href="#ordering-the-display-of-results" title="Permanent link">&para;</a></h3>
<p>ordering the display of results is achieved by using the <code>ORDER BY</code> clause.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">attribute_list</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">attribute_name</span><span class="p">;</span>
</span></code></pre></div>
<p>We may specify desc for descending order or asc for ascending order, and for each attribute, ascending order is the default. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div>
<p>This will return all the employees sorted by salary in descending order.</p>
<h2 id="set-operations">SET Operations<a class="headerlink" href="#set-operations" title="Permanent link">&para;</a></h2>
<p>In SQL, use the set operations including <code>UNION</code>, <code>INTERSECT</code>, and <code>EXCEPT</code> operate on relations as well as correspond to the relational algebra operations <span class="arithmatex">\(\cup\)</span>, <span class="arithmatex">\(\cap\)</span>, and <span class="arithmatex">\(\setminus\)</span>.</p>
<p>Each of the operations including <code>UNION</code>, <code>INTERSECT</code>, and <code>EXCEPT</code> automatically eliminates duplicates. To retain duplicates, use <code>UNION ALL</code>, <code>INTERSECT ALL</code>, and <code>EXCEPT ALL</code> instead.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Find all customers who have a loan or an account or both. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="k">UNION</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="p">;</span>
</span></code></pre></div>
<p>Find all customers who have both a loan and an account.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="k">INTERSECT</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="p">;</span>
</span></code></pre></div>
<p>Find all customers who have a loan but not an account.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="k">EXCEPT</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="p">;</span>
</span></code></pre></div>
</div>
<h2 id="aggregate-functions">Aggregate Functions<a class="headerlink" href="#aggregate-functions" title="Permanent link">&para;</a></h2>
<p>Aggregate functions are used to perform calculations on a set of values(a column) and return a single value.</p>
<ul>
<li><code>COUNT</code>: Counts the number of rows</li>
<li><code>SUM</code>: Calculates the sum of a set of values</li>
<li><code>AVG</code>: Calculates the average of a set of values</li>
<li><code>MAX</code>: Finds the maximum value</li>
<li><code>MIN</code>: Finds the minimum value</li>
</ul>
<p>Such as:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_employees</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="p">;</span>
</span></code></pre></div>
<p>This will return the number of rows in the employees table.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>COUNT(*)</code> function counts all rows, including those with null values.</p>
<p>But <code>COUNT(attribute_name)</code> function counts only the rows where the attribute is not null.</p>
<p>We can also use <code>COUNT(distinct attribute_name)</code> to count the number of distinct values in a column.</p>
</div>
<h3 id="group-by">Group By<a class="headerlink" href="#group-by" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="n">avg_bal</span><span class="w"> </span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>在 SQL 中，当你在 <code>SELECT</code> 子句中使用聚合函数（例如 <code>AVG</code>、<code>SUM</code> 等）时，所有不在聚合函数中的属性（字段）必须出现在 <code>GROUP BY</code> 子句中。这是因为 SQL 需要知道如何对数据进行分组，以便正确地计算聚合值。</p>
<p>否则在这种情况下，在前面要求了挑出Branch_name,where 中又要求branch_name = 'Perryridge'；没什么意义</p>
<p>正确的写法是：</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="n">avg_bal</span><span class="w"> </span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">branch_name</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="having">Having<a class="headerlink" href="#having" title="Permanent link">&para;</a></h3>
<p>The <code>HAVING</code> clause is used to filter the results of a <code>GROUP BY</code> operation.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="n">avg_bal</span><span class="w"> </span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="k">HAVING</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
</span></code></pre></div>
<p>This will return all the branches whose average balance is greater than 1000.</p>
<h2 id="summary-of-select">Summary of Select<a class="headerlink" href="#summary-of-select" title="Permanent link">&para;</a></h2>
<p>Select 语句的完整语法如下：</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="p">[</span><span class="k">DISTINCT</span><span class="p">]</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="p">,</span><span class="w"> </span><span class="err">…</span><span class="o">&gt;</span><span class="w"> </span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">r1</span><span class="p">,</span><span class="w"> </span><span class="err">…</span><span class="o">&gt;</span><span class="w"> </span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">        </span><span class="p">[</span><span class="k">WHERE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">        </span><span class="p">[</span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="p">,</span><span class="w"> </span><span class="err">…</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="k">HAVING</span><span class="w"> </span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span><span class="p">]]</span><span class="w"> </span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">        </span><span class="p">[</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="n">c1</span><span class="w"> </span><span class="p">[</span><span class="k">DESC</span><span class="p">]</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="p">[</span><span class="k">DESC</span><span class="o">|</span><span class="k">ASC</span><span class="p">],</span><span class="w"> </span><span class="err">…</span><span class="p">]</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span>
</span></code></pre></div>
<p>[] 表示可选部分</p>
<p>其执行顺序为</p>
<pre class="mermaid"><code>flowchart LR
    A[From] --&gt; B[Where]
    B --&gt; C[Group By / aggregate]
    C --&gt; D[Having]
    D --&gt; E[Select]
    E --&gt; F[Distinct]
    F --&gt; G[Order By]</code></pre>
<div style="text-align: center;font-size: 1em;color: blue;">Note that predicates in the having clause are applied after the formation of groups, whereas predicates in the where clause are applied before forming groups.</div>

<h2 id="null-values">Null Values<a class="headerlink" href="#null-values" title="Permanent link">&para;</a></h2>
<p>Null is a special marker used in SQL and was first introduced by E.F. Codd in 1974.</p>
<p>The meaning of null is that the value is unknown or not applicable.</p>
<p>The result of any arithmetic operation involving null is null.</p>
<blockquote>
<p>5+null = null</p>
</blockquote>
<p>Any comparison involving null is 'unknown', which is neither true nor false.</p>
<blockquote>
<p>null = null is unknown</p>
</blockquote>
<div class="admonition info">
<p class="admonition-title">unknown</p>
<p>Three-valued logic using the truth value unknown: (true, false, unknown)</p>
<ul>
<li>
<p><code>OR</code> operation: </p>
<ul>
<li>(unknown OR true) = true</li>
<li>(unknown OR false) = unknown </li>
<li>(unknown OR unknown) = unknown</li>
</ul>
</li>
<li>
<p><code>AND</code> operation:</p>
<ul>
<li>(unknown AND true) = unknown</li>
<li>(unknown AND false) = false</li>
<li>(unknown AND unknown) = unknown</li>
</ul>
</li>
<li>
<p><code>NOT</code> operation:</p>
<ul>
<li>(NOT unknown) = unknown</li>
</ul>
</li>
<li>
<p><code>=</code> operation:</p>
<ul>
<li>(unknown = unknown) = unknown</li>
</ul>
</li>
<li>
<p><code>!=</code> operation:</p>
<ul>
<li>(unknown != unknown) = unknown</li>
</ul>
</li>
</ul>
</div>
<p>The predicate <code>IS NULL</code>  and <code>IS NOT NULL</code> are used to test for null values.</p>
<blockquote>
<p>recall that the primary key of a relation cannot be null.</p>
</blockquote>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Find all loan number which appears in the loan relation with null values for amount. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">loan_number</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">loan</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</span></code></pre></div>
<p>we cannot use <code>=</code> to test for null values,the result will return null.</p>
<p>see as follows:</p>
<p><figure markdown="span">
<img alt="null" src="../img/sql-1.png" width="300" />
</figure></p>
</div>
<h3 id="null-values-in-aggregate-functions">Null Values in Aggregate Functions<a class="headerlink" href="#null-values-in-aggregate-functions" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="p">;</span>
</span></code></pre></div>
<p>This will return the sum of the balance of all the accounts.Result is null if there is no non-null values.</p>
<p>All aggregate operations <strong>except count(*)</strong> ignore tuples with null values on the aggregated attributes. </p>
<h2 id="nested-subqueries">Nested Subqueries<a class="headerlink" href="#nested-subqueries" title="Permanent link">&para;</a></h2>
<p>Nested subqueries in SQL are queries within queries. They allow you to perform more complex queries by embedding one query inside another. This is particularly useful when you need to filter data based on the results of another query.</p>
<h3 id="basic-structure_1">Basic Structure<a class="headerlink" href="#basic-structure_1" title="Permanent link">&para;</a></h3>
<p>A nested subquery is typically found in the <code>WHERE</code> clause of a SQL statement. The subquery is executed first, and its result is used by the outer query.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">column1</span><span class="p">,</span><span class="w"> </span><span class="n">column2</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">table1</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">column3</span><span class="w"> </span><span class="o">&lt;</span><span class="k">operator</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">column3</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">table2</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">condition</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="p">);</span>
</span></code></pre></div>
<p>the <code>&lt;operator&gt;</code> can be <code>=</code>, <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>IN</code>, <code>NOT IN</code>, <code>ANY</code>, <code>ALL</code>, <code>EXISTS</code>, <code>NOT EXISTS</code>. </p>
<p>it can also be nested in the FROM clause.</p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">column1</span><span class="p">,</span><span class="w"> </span><span class="n">column2</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">column3</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">table2</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">subquery</span><span class="p">;</span>
</span></code></pre></div>
or in the having clause such as:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">department</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_salary</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">department</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="k">HAVING</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="p">);</span>
</span></code></pre></div>
<blockquote>
<p>找出每个 [部门平均工资] 大于[所有员工平均工资]的部门。</p>
</blockquote>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Find all customers who have both an account and a loan at the bank. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">customer_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_id</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="p">);</span>
</span></code></pre></div>
<p>recall that we can also use the set operation to achieve the same result.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="k">INTERSECT</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="p">;</span>
</span></code></pre></div>
<p>Find  all customers who have both an account and a loan at the Perryridge branch. </p>
<ul>
<li>
<p>query 1:
<div class="language-sql highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">customer_name</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="n">L</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">loan_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="p">.</span><span class="n">loan_number</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">customer_name</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">customer_name</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">A</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">D</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">  </span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p>query 2:
<div class="language-sql highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">customer_name</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="n">L</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">loan_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="p">.</span><span class="n">loan_number</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">A</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">D</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p>query 3:指定名称，将外层的结果传递进去
<div class="language-sql highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">customer_name</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">loan_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">loan_number</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">A</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">D</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="c1">-- branch_name is the same as the branch_name in the outer (Perryridge)</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="p">);</span>
</span></code></pre></div></p>
</li>
</ul>
</div>
<p>Find the account_number with the maximum balance for every branch.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">account_number</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">          </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span>
</span></code></pre></div>
<p>错，聚合函数不能在where子句中使用</p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">account_number</span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span>
</span></code></pre></div>
错误，account_number不是聚合函数的一部分，且没有在group by子句中</p>
<p>正确的为</p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1">-- Select account number and balance from the account table</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">account_number</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AN</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">A</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="c1">-- Filter to get accounts with the maximum balance in each branch</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">    </span><span class="c1">-- Subquery to get the maximum balance for each branch</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">B</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">branch_name</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="p">)</span>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="c1">-- Order the results by balance</span>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">balance</span><span class="p">;</span>
</span></code></pre></div>
但是
<div class="language-sql highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">account_number</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="k">HAVING</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span>
</span></code></pre></div>
错误，max(balance)是聚合列，balance不是聚合列</p>
<h3 id="set-comparison">Set Comparison<a class="headerlink" href="#set-comparison" title="Permanent link">&para;</a></h3>
<p>Find all branches that have greater assets than some branch located in Brooklyn. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">assets</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">SOME</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">assets</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Brooklyn&#39;</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="p">);</span>
</span></code></pre></div>
<p>Find all branches that have greater assets than all branches located in Brooklyn.</p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">assets</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">assets</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Brooklyn&#39;</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="p">);</span>
</span></code></pre></div>
or</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">assets</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Brooklyn&#39;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="test-for-empty-relations">Test for Empty Relations<a class="headerlink" href="#test-for-empty-relations" title="Permanent link">&para;</a></h3>
<p>The <code>exists</code> construct returns the value true if the argument subquery is non-empty. </p>
<ul>
<li><code>exists</code> <span class="arithmatex">\(r\)</span> equal to <span class="arithmatex">\(r \neq \emptyset\)</span></li>
<li><code>not exists</code> <span class="arithmatex">\(r\)</span> equal to <span class="arithmatex">\(r = \emptyset\)</span></li>
</ul>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Find all customers who have accounts at all branches located in city Brooklyn. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">customer_name</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">S</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">     </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Brooklyn&#39;</span><span class="p">)</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">     </span><span class="k">EXCEPT</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="w">     </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">branch_name</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">R</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">customer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">customer_name</span><span class="p">)</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<p>即挑出的S将满足，<strong>Brooklyn所有支行的branch_number减去S有账户的branch_number后，为空</strong>。
而由于</p>
<div class="arithmatex">\[
   A - B = \emptyset \iff A \subseteq B
\]</div>
<p>所以挑出的S将满足，<strong>S有账户的branch_number包含了Brooklyn所有支行的branch_number</strong>。</p>
<p>也就满足了要求。</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">customer_name</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">S</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="n">B</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Brooklyn&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">R</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">branch_name</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">customer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">customer_name</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="p">);</span>
</span></code></pre></div>
<p>这里有两个not exists，里面的select子句挑出了在Brooklyn中没有某些支行账户的表格，外面的not exists挑出了不存在这一条件的客户;
即 <strong>不存在在Brooklyn中不存在账户的客户</strong> ，也就是 <strong>在Brooklyn的所有支行都有账户的客户</strong> 。</p>
</div>
<h3 id="test-for-absence-of-duplicate-tuples">Test for Absence of Duplicate Tuples<a class="headerlink" href="#test-for-absence-of-duplicate-tuples" title="Permanent link">&para;</a></h3>
<p>The unique construct tests whether a subquery has any duplicate tuples in its result. </p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Find all customers who have at most one account at the Perryridge branch. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">customer_name</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="p">,</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">R</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">customer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">customer_name</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="p">);</span>
</span></code></pre></div>
<p>Find all customers who have at least two accounts at the Perryridge branch. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">customer_name</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">T</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">customer_name</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="p">,</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">R</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">customer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">customer_name</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="p">);</span>
</span></code></pre></div>
</div>
<h2 id="views">Views<a class="headerlink" href="#views" title="Permanent link">&para;</a></h2>
<p>A view is a virtual table that is defined by a query. It is a stored query that can be used to simplify complex queries and to provide a consistent view of the data.</p>
<p>Provide a mechanism to hide certain data from the view of certain users. </p>
<h3 id="create-view">Create View<a class="headerlink" href="#create-view" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">view_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">attribute_list</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">condition</span><span class="p">;</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="c1">-- or</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">view_name</span><span class="w"> </span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="p">,</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="n">cn</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">attribute_list</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">condition</span><span class="p">;</span>
</span></code></pre></div>
<div class="admonition advice">
<p class="admonition-title">Advice</p>
<p>Benefits of using views 
- Security 
- Easy to use, support logical independence
- Simplify complex queries
- Hide certain data from the view of certain users</p>
</div>
<h3 id="drop-view">Drop View<a class="headerlink" href="#drop-view" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="k">DROP</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">view_name</span><span class="p">;</span>
</span></code></pre></div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Create a view consisting of branches and their customer names. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">all_customer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="p">(</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="w">     </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="w">     </span><span class="k">WHERE</span><span class="w"> </span><span class="n">depositor</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">account_number</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="w">   </span><span class="k">UNION</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">customer_name</span><span class="w"> </span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">     </span><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span><span class="p">,</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="w">     </span><span class="k">WHERE</span><span class="w"> </span><span class="n">borrower</span><span class="p">.</span><span class="n">loan_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loan</span><span class="p">.</span><span class="n">loan_number</span><span class="p">)</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="p">);</span>
</span></code></pre></div>
</div>
<h2 id="derived-relations">Derived Relations<a class="headerlink" href="#derived-relations" title="Permanent link">&para;</a></h2>
<p>In SQL, Derived Relations (derived relations) are created through subqueries (subquery) in the <code>FROM</code> clause. They are typically used to simplify complex queries and make them more readable.</p>
<p>Such as:Find the average account balance of those branches where the average account balance is greater than $500. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">avg_bal</span><span class="w"> </span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">     </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="w">      </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">branch_name</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="w">      </span><span class="k">as</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">avg_bal</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="w">     </span><span class="k">WHERE</span><span class="w"> </span><span class="n">avg_bal</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span>
</span></code></pre></div>
<blockquote>
<p>The derived table must have its own alias</p>
</blockquote>
<h3 id="with-clause">With Clause<a class="headerlink" href="#with-clause" title="Permanent link">&para;</a></h3>
<p>The WITH clause allows views to be defined locally for a query, rather than globally. </p>
<blockquote>
<p><code>WITH</code> 子句允许在查询中局部定义视图，而不是全局定义。这意味着你可以在一个特定的查询中创建一个临时的视图，这个视图只在该查询的上下文中可用，而不会影响数据库的其他部分。这种方法的好处是可以简化复杂查询，使其更易于阅读和维护，同时避免在数据库中创建永久视图。使用 <code>WITH</code> 子句，你可以在查询中定义多个子查询，并在主查询中引用它们，从而提高查询的可读性和效率。</p>
</blockquote>
<p>Such as:Find all accounts with the maximum balance. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="k">WITH</span><span class="w"> </span><span class="n">max_balance</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="p">)</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">account_number</span><span class="w"> </span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="p">,</span><span class="w"> </span><span class="n">max_balance</span><span class="w"> </span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_balance</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="modification-of-database">Modification of Database<a class="headerlink" href="#modification-of-database" title="Permanent link">&para;</a></h2>
<h3 id="deletion">Deletion<a class="headerlink" href="#deletion" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">condition</span><span class="p">;</span>
</span></code></pre></div>
<p>such as: Delete all accounts and relevant information at depositor for every branch located in Needham city. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Needham&#39;</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="p">);</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">account_number</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">account_number</span><span class="w"> </span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">A</span><span class="w"> </span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Needham&#39;</span><span class="w"> </span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">branch_name</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a><span class="p">);</span>
</span></code></pre></div>
<p>以下写法错误</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="p">,</span><span class="w"> </span><span class="n">depositor</span><span class="p">,</span><span class="w"> </span><span class="n">branch</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">depositor</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="k">AND</span><span class="w"> </span><span class="n">branch</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">branch_name</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="k">AND</span><span class="w"> </span><span class="n">branch_city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Needham&#39;</span><span class="p">;</span>
</span></code></pre></div>
<div style="color: red;">
每一个delete语句，只能够针对一个表进行操作，不能够针对多个表进行操作。
</div>

<p>Example2:</p>
<p>Delete the record of all accounts with balances below the average at the bank. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span><span class="p">);</span>
</span></code></pre></div>
<p><strong>Problem:</strong> as we delete tuples from account, the average 
balance changes.</p>
<p><strong>Solution:</strong></p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="k">WITH</span><span class="w"> </span><span class="n">avg_balance</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_bal</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="p">),</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="n">to_delete</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">account_number</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">avg_bal</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">avg_balance</span><span class="p">)</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="p">)</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">account_number</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">account_number</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">to_delete</span><span class="p">);</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>在同一SQL语句内，除非外层查询的元组变量引入内层查询，否则层查询只进行一次.</p>
<p>这句话的意思是：在一个 SQL 语句中，除非外层查询的元组变量（即表的别名或列名）被引入到内层查询中，否则内层查询只会执行一次。</p>
<p>换句话说，如果内层查询不依赖于外层查询的任何变量或条件，那么内层查询会在整个 SQL 语句执行过程中只运行一次，并将其结果用于外层查询的每一行。如果内层查询依赖于外层查询的变量，那么内层查询可能会为外层查询的每一行执行一次。</p>
</div>
<h3 id="insertion">Insertion<a class="headerlink" href="#insertion" title="Permanent link">&para;</a></h3>
<p>Add a new tuple to the relation.</p>
<p>Format:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="o">|</span><span class="k">view</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[(</span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="p">,</span><span class="err">…</span><span class="p">)]</span><span class="w"> </span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="w">      </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="n">e2</span><span class="p">,</span><span class="w"> </span><span class="err">…</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="c1">-- or</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="o">|</span><span class="k">view</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[(</span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">c2</span><span class="p">,</span><span class="err">…</span><span class="p">)]</span><span class="w"> </span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="n">e2</span><span class="p">,</span><span class="w"> </span><span class="err">…</span><span class="w"> </span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="err">…</span><span class="w"> </span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="p">(</span><span class="n">account_number</span><span class="p">,</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;A_9732&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1200</span><span class="p">);</span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="c1">-- or equivalently</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="p">(</span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">,</span><span class="w"> </span><span class="n">account_number</span><span class="p">)</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Perryridge&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A_9732&#39;</span><span class="p">);</span>
</span></code></pre></div>
<p>Such as:Provide as a gift for all loan customers of the Perryridge branch, a $200 savings account.  Let the loan number serve as the account number for the new savings account. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="c1">-- Step 1: insert into account</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="p">(</span><span class="n">account_number</span><span class="p">,</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">loan_number</span><span class="p">,</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="k">FROM</span><span class="w"> </span><span class="n">loan</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span><span class="p">;</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="c1">-- Step 2: insert into depositor</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="p">(</span><span class="n">customer_name</span><span class="p">,</span><span class="w"> </span><span class="n">account_number</span><span class="p">)</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">loan_number</span>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a><span class="k">FROM</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">borrower</span><span class="w"> </span><span class="n">B</span>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">loan_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">loan_number</span><span class="p">;</span>
</span></code></pre></div>
<div class="admonition question">
<p class="admonition-title">what? select 200?</p>
<p>在 SQL 中，<code>SELECT</code> 语句可以用于从一个或多个表中提取数据，
并且可以在 <code>SELECT</code> 子句中使用常量值。常量值会被应用到每一行的结果中。</p>
<p>代码中：</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="p">(</span><span class="n">account_number</span><span class="p">,</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">loan_number</span><span class="p">,</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">loan</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span><span class="p">;</span>
</span></code></pre></div>
<p>这里的 <code>SELECT loan_number, branch_name, 200</code> 是从 <code>loan</code> 表中选择 <code>loan_number</code> 和 <code>branch_name</code>，并且为每一行都插入一个常量值 <code>200</code> 作为 <code>balance</code>。
这意味着对于每一个符合条件的 <code>loan</code> 表中的记录，都会插入一条新的记录到 <code>account</code> 表中，其中 <code>balance</code> 字段的值固定为 <code>200</code>。
这种用法在 SQL 中是合法的，并且常用于在插入数据时为某些字段设置默认值或固定值。</p>
</div>
<p>The "select from where" statement is fully evaluated before any of its results are inserted into the relation. </p>
<h3 id="updates">Updates<a class="headerlink" href="#updates" title="Permanent link">&para;</a></h3>
<p>Update the value of an attribute of a tuple.</p>
<p>Format:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="k">UPDATE</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="o">&gt;</span><span class="w"> </span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">          </span><span class="k">SET</span><span class="w"> </span><span class="o">&lt;</span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e1</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e2</span><span class="p">,</span><span class="w"> </span><span class="err">…</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="k">WHERE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span>
</span></code></pre></div>
<p>Such as:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="k">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">05</span><span class="w"> </span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span><span class="p">;</span>
</span></code></pre></div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Increase all accounts with balances over $10,000 by 6%, all other accounts receive 5%. </p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="k">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">06</span><span class="w"> </span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="k">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">05</span><span class="w"> </span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
</span></code></pre></div>
The order is important.
如果顺序反过来，那么有可能一开始没有10000，先更新了，然后就变成10000了，然后又可以增加6%了。</p>
</div>
<h4 id="case-statement-for-conditional-updates">Case Statement for Conditional Updates<a class="headerlink" href="#case-statement-for-conditional-updates" title="Permanent link">&para;</a></h4>
<p>The same query as before: Increase all accounts with balances over $10,000 by 6%, and all other accounts receive 5%. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="k">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CASE</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">05</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w">    </span><span class="k">ELSE</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">06</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="k">END</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="update-of-view">Update of view<a class="headerlink" href="#update-of-view" title="Permanent link">&para;</a></h4>
<p>Example:Create a view of all loan data in loan relation, hiding the amount attribute. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">branch_loan</span><span class="w"> </span><span class="k">as</span><span class="w"> </span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">loan_number</span><span class="w"> </span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">loan</span><span class="p">;</span>
</span></code></pre></div>
<p>Add a new tuple to branch_loan. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">branch_loan</span><span class="w"> </span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Perryridge&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;L-307&#39;</span><span class="p">)</span><span class="w"> </span>
</span></code></pre></div>
<p>This insertion will be translated into: </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;L-307&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Perryridge&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span>
</span></code></pre></div>
<p>Updates on more complex views are difficult or impossible to translate into updates on the base relations,and hence are not allowed.</p>
<h4 id="summary-of-update-on-view">Summary of update on view<a class="headerlink" href="#summary-of-update-on-view" title="Permanent link">&para;</a></h4>
<ul>
<li>View 是虚表，对其进行的所有操作都将转化为对基表的操作。</li>
<li>查询操作时，VIEW与基表没有区别，但对VIEW的更新操作有严格限制，如只有行列视图(建立在单个基本表上的视图，且视图的列对应表的列，称为"行列视图"。)，可更新数据</li>
<li>大多数SQL实现只允许在单个关系上定义的简单视图上进行更新操作，且不包含聚合函数</li>
</ul>
<h3 id="transaction">Transaction<a class="headerlink" href="#transaction" title="Permanent link">&para;</a></h3>
<p>在 SQL 中，事务（Transaction）是指一系列查询和数据更新语句，这些语句作为一个单一的逻辑单元执行。事务的目的是确保数据库操作的完整性和一致性。事务通常具有以下四个特性，简称为 ACID：</p>
<ol>
<li>
<p><strong>原子性（Atomicity）</strong>：事务中的所有操作要么全部完成，要么全部不完成。事务不能只完成其中的一部分。</p>
</li>
<li>
<p><strong>一致性（Consistency）</strong>：事务的执行必须使数据库从一个一致的状态转变为另一个一致的状态。</p>
</li>
<li>
<p><strong>隔离性（Isolation）</strong>：一个事务的执行不能被其他事务干扰。即使多个事务并发执行，在事务之间的操作结果是相互隔离的。</p>
</li>
<li>
<p><strong>持久性（Durability）</strong>：一旦事务提交，其结果就应该永久保存在数据库中，即使系统发生故障。</p>
</li>
</ol>
<p>在 SQL 中，事务通常是隐式启动的，并通过以下两种方式之一来终止：</p>
<ul>
<li>
<p><strong>COMMIT WORK</strong>：提交事务，将事务中所有的更新永久地保存到数据库中。这意味着事务中的所有操作都被确认并生效。</p>
</li>
<li>
<p><strong>ROLLBACK WORK</strong>：回滚事务，撤销事务中执行的所有更新。这意味着事务中的所有操作都被取消，数据库状态恢复到事务开始之前的状态。</p>
</li>
</ul>
<p>通过使用 <code>COMMIT</code> 和 <code>ROLLBACK</code>，可以控制事务的完成或取消，从而确保数据库的可靠性和一致性，即使在出现错误或系统崩溃的情况下。</p>
<h2 id="joined-relations">Joined Relations<a class="headerlink" href="#joined-relations" title="Permanent link">&para;</a></h2>
<p>Join operations take as input two relations and return as a result another relation. </p>
<p><span style="color:red">Join condition</span> – defines which tuples in the two relations match, and what attributes are present in the result of the join. </p>
<p><span style="color:red">Join type</span> – defines how tuples in each relation that do not match any tuple in the other relation (based on the join condition) are treated. </p>
<ul>
<li>自然连接：自然连接是一种特殊的等值连接，它要求两个关系中所有同名属性都相等，不需要指定连接条件。</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="n">R</span><span class="w"> </span><span class="k">natural</span><span class="w"> </span><span class="err">{</span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="p">,</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="p">,</span><span class="w"> </span><span class="k">right</span><span class="w"> </span><span class="k">join</span><span class="p">,</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="k">join</span><span class="err">}</span><span class="w"> </span><span class="n">S</span><span class="w"> </span>
</span></code></pre></div>
<ul>
<li>非自然连接： 需要指定连接条件。</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="n">R</span><span class="w"> </span><span class="err">{</span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="p">,</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="p">,</span><span class="w"> </span><span class="k">right</span><span class="w"> </span><span class="k">join</span><span class="p">,</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="k">join</span><span class="err">}</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">A1</span><span class="p">,</span><span class="w"> </span><span class="n">A2</span><span class="p">,</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="n">An</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="inner-join">INNER JOIN<a class="headerlink" href="#inner-join" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>作用</strong>：返回两个表中匹配的行。</li>
<li><strong>语法</strong>：
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">columns</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">table1</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">table2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">table1</span><span class="p">.</span><span class="k">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">table2</span><span class="p">.</span><span class="k">column</span><span class="p">;</span>
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="left-join-left-outer-join">LEFT JOIN (LEFT OUTER JOIN)<a class="headerlink" href="#left-join-left-outer-join" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>作用</strong>：返回左表所有行 + 右表匹配的行（未匹配的右表字段为 <code>NULL</code>）。</li>
<li><strong>语法</strong>：
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">columns</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">table1</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">table2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">table1</span><span class="p">.</span><span class="k">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">table2</span><span class="p">.</span><span class="k">column</span><span class="p">;</span>
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="right-join-right-outer-join">RIGHT JOIN (RIGHT OUTER JOIN)<a class="headerlink" href="#right-join-right-outer-join" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>作用</strong>：返回右表所有行 + 左表匹配的行（未匹配的左表字段为 <code>NULL</code>）。</li>
<li><strong>语法</strong>：
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">columns</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">table1</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">table2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">table1</span><span class="p">.</span><span class="k">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">table2</span><span class="p">.</span><span class="k">column</span><span class="p">;</span>
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="full-outer-join">FULL OUTER JOIN<a class="headerlink" href="#full-outer-join" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>作用</strong>：返回左右表所有行（未匹配的字段为 <code>NULL</code>）。</li>
<li><strong>语法</strong>：
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">columns</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">table1</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="k">FULL</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">table2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">table1</span><span class="p">.</span><span class="k">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">table2</span><span class="p">.</span><span class="k">column</span><span class="p">;</span>
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="cross-join">CROSS JOIN<a class="headerlink" href="#cross-join" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>作用</strong>：返回两表的笛卡尔积（无连接条件）。</li>
<li><strong>语法</strong>：
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">columns</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">table1</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">table2</span><span class="p">;</span>
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="self-join">SELF JOIN<a class="headerlink" href="#self-join" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>作用</strong>：将表与自身连接，常用于层级或对称关系查询。</li>
<li><strong>语法</strong>：
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">column</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">column</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">a</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="k">JOIN</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">column</span><span class="p">;</span>
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="join-condition">JOIN condition<a class="headerlink" href="#join-condition" title="Permanent link">&para;</a></h3>
<h4 id="on">ON<a class="headerlink" href="#on" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>作用</strong>：指定任意连接条件（支持多条件和复杂逻辑）。</li>
<li><strong>语法</strong>：
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customers</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</span></code></pre></div></li>
</ul>
<h4 id="using">USING<a class="headerlink" href="#using" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>作用</strong>：简化同名列的连接（自动匹配列名）。</li>
<li><strong>语法</strong>：
  <div class="language-sql highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="k">JOIN</span><span class="w"> </span><span class="n">departments</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">dept_id</span><span class="p">);</span>
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="join-performance-optimization">JOIN performance optimization<a class="headerlink" href="#join-performance-optimization" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>索引优化</strong>：  </li>
<li>在连接列（如 <code>dept_id</code>）上创建索引。</li>
<li><strong>减少数据量</strong>：  </li>
<li>先通过 <code>WHERE</code> 过滤再 <code>JOIN</code>。</li>
<li><strong>避免笛卡尔积</strong>：  </li>
<li>确保 <code>CROSS JOIN</code> 是必要且可控的。</li>
<li><strong>使用 EXPLAIN</strong>：  </li>
<li>分析查询计划，检查连接顺序和算法（如 Nested Loop、Hash Join）。</li>
</ol>
<hr />
<h3 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>JOIN 类型</th>
<th>匹配规则</th>
<th>是否保留未匹配数据</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>INNER JOIN</code></td>
<td>仅匹配的行</td>
<td>否</td>
</tr>
<tr>
<td><code>LEFT JOIN</code></td>
<td>左表全保留 + 右表匹配</td>
<td>左表未匹配行保留</td>
</tr>
<tr>
<td><code>RIGHT JOIN</code></td>
<td>右表全保留 + 左表匹配</td>
<td>右表未匹配行保留</td>
</tr>
<tr>
<td><code>FULL OUTER JOIN</code></td>
<td>左右表全保留</td>
<td>左右表未匹配行均保留</td>
</tr>
<tr>
<td><code>CROSS JOIN</code></td>
<td>无条件，笛卡尔积</td>
<td>不适用</td>
</tr>
</tbody>
</table>
<h2 id="advanced-sql">Advanced SQL<a class="headerlink" href="#advanced-sql" title="Permanent link">&para;</a></h2>
<h3 id="sql-data-types-and-schemas">SQL Data Types and Schemas<a class="headerlink" href="#sql-data-types-and-schemas" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://www.postgresql.org/docs/current/datatype.html">Built-in types</a></li>
</ul>
<h4 id="user-defined-types">User-defined types<a class="headerlink" href="#user-defined-types" title="Permanent link">&para;</a></h4>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
</span></code></pre></div>
也可以定义复合类型</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="w">    </span><span class="n">street</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="w">    </span><span class="n">city</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="p">);</span>
</span></code></pre></div>
<p>Create a table with the address type:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="w">    </span><span class="n">person_address</span><span class="w"> </span><span class="n">address</span>
</span><span id="__span-102-5"><a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="p">);</span>
</span></code></pre></div>
<p>Drop the address type:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="k">DROP</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="create-new-domain">Create new domain<a class="headerlink" href="#create-new-domain" title="Permanent link">&para;</a></h4>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">DOMAIN</span><span class="w"> </span><span class="n">domain_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">data_type</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="p">[</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">default_value</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="p">[</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="k">constraint_name</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">expression</span><span class="p">)</span><span class="w"> </span><span class="p">];</span>
</span></code></pre></div>
<p>such as
<div class="language-sql highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">domain</span><span class="w"> </span><span class="n">Dollars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">numeric</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="k">Create</span><span class="w"> </span><span class="k">domain</span><span class="w"> </span><span class="n">Pounds</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">numeric</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="k">Create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="w">        </span><span class="p">(</span><span class="n">eno</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="w">            </span><span class="n">ename</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a><span class="w">            </span><span class="n">job</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-105-7"><a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a><span class="w">            </span><span class="n">salary</span><span class="w"> </span><span class="n">Dollars</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-105-8"><a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a><span class="w">            </span><span class="n">comm</span><span class="w"> </span><span class="n">Pounds</span><span class="p">);</span><span class="w"> </span>
</span></code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">domain vs type</p>
<p>在 SQL 中，<code>DOMAIN</code> 和 <code>TYPE</code> 都用于定义自定义的数据类型，但它们有不同的用途和特性。</p>
<p><code>DOMAIN</code> 是基于现有数据类型的约束集合。它允许你为特定的数据类型添加约束条件，以确保数据的完整性。
主要用于在多个表中重用相同的数据类型和约束。例如，定义一个 <code>DOMAIN</code> 来表示电子邮件地址，并附加格式检查约束。
可以附加 <code>CHECK</code> 约束来验证数据的有效性。
<code>DOMAIN</code> 继承了基础数据类型的所有特性，并可以在其上添加额外的约束。
示例:
<div class="language-sql highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">DOMAIN</span><span class="w"> </span><span class="n">email_domain</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">VALUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s1">&#39;^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$&#39;</span><span class="p">);</span>
</span></code></pre></div></p>
<p><code>TYPE</code> 是用于定义新的数据类型，特别是复合类型（包含多个字段）或枚举类型。
适用于需要定义复杂数据结构的场景，例如需要在表中存储地址信息的多个字段。
复合类型可以包含多个字段，每个字段可以有不同的数据类型。
枚举类型可以定义一组固定的值。
示例:
复合类型:
<div class="language-sql highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="w">    </span><span class="n">street</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="w">    </span><span class="n">city</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="w">    </span><span class="n">zip_code</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="p">);</span>
</span></code></pre></div>
枚举类型:
<div class="language-sql highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">mood</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ENUM</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;happy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sad&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;neutral&#39;</span><span class="p">);</span>
</span></code></pre></div></p>
</div>
<h4 id="large-object-types">Large object types<a class="headerlink" href="#large-object-types" title="Permanent link">&para;</a></h4>
<p>SQL provides two types of large object data types:</p>
<ul>
<li>
<p><code>BLOB</code> (Binary Large Object)</p>
<ul>
<li>Stores large collections of uninterpreted binary data</li>
<li>Examples: images, videos, CAD files</li>
<li>Interpretation is handled by external applications</li>
<li>Maximum size depends on DBMS implementation</li>
</ul>
</li>
<li>
<p><code>CLOB</code> (Character Large Object) </p>
<ul>
<li>Stores large collections of character/text data</li>
<li>Examples: documents, XML files, long text</li>
<li>Data is interpreted as character strings</li>
<li>Maximum size depends on DBMS implementation</li>
</ul>
</li>
</ul>
<p>When querying large objects, the database returns a pointer/reference to the data rather than the full object itself. This helps optimize performance and memory usage.</p>
<p>Example usage:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="w">    </span><span class="n">sid</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="w">    </span><span class="n">gender</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="w">    </span><span class="n">photo</span><span class="w"> </span><span class="nb">blob</span><span class="p">(</span><span class="mi">20</span><span class="n">MB</span><span class="p">),</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="w">    </span><span class="n">cv</span><span class="w"> </span><span class="k">clob</span><span class="p">(</span><span class="mi">10</span><span class="n">KB</span><span class="p">)</span>
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="p">);</span>
</span></code></pre></div>
<figure>
<img alt="" src="../img/asql-1.png" width="500" />
</figure>
<h3 id="integrity-constraints_1">Integrity Constraints<a class="headerlink" href="#integrity-constraints_1" title="Permanent link">&para;</a></h3>
<p>Integrity constraints guard against accidental damage to the database, by ensuring that authorized changes to the database do not result in a loss of data consistency. </p>
<ul>
<li>实体完整性、参照完整性和用户定义的完整性约束 </li>
<li>完整性约束是数据库实例(Instance)必须遵循的 </li>
<li>完整性约束由DBMS维护 </li>
</ul>
<div class="admonition extra">
<p class="admonition-title">Extra</p>
<p>Constraints on a single relation：</p>
<ul>
<li>Not null</li>
<li>Unique</li>
<li>Primary key</li>
<li>Foreign key</li>
<li>Check(Predicate)</li>
</ul>
<p>Eg.
<div class="language-sql highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">branch2</span><span class="w"> </span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="p">(</span><span class="n">branch_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="n">branch_city</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="n">assets</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="k">check</span><span class="w"> </span><span class="p">(</span><span class="n">assets</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span><span class="w"> </span>
</span></code></pre></div></p>
</div>
<h4 id="domain-constraints">Domain Constraints<a class="headerlink" href="#domain-constraints" title="Permanent link">&para;</a></h4>
<p>The check clause in SQL-92 permits domains to be restricted: 
<div class="language-sql highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">domain</span><span class="w"> </span><span class="n">hourly</span><span class="o">-</span><span class="n">wage</span><span class="w"> </span><span class="nb">numeric</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="k">Constraint</span><span class="w"> </span><span class="n">value</span><span class="o">-</span><span class="n">test</span><span class="w"> </span><span class="k">check</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">00</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="c1">--The clause constraint value-test is optional; useful to indicate which constraint an update violated. </span>
</span></code></pre></div>
为约束命名可以更容易地诊断问题；</p>
<h4 id="referential-integrity">Referential Integrity<a class="headerlink" href="#referential-integrity" title="Permanent link">&para;</a></h4>
<p>Let <span class="arithmatex">\(r_1(R_1)\)</span> and <span class="arithmatex">\(r_2(R_2)\)</span> be the relations with primary keys <span class="arithmatex">\(K_1\)</span> and <span class="arithmatex">\(K_2\)</span>, respectively. </p>
<p>The subset <span class="arithmatex">\(\alpha\)</span> of <span class="arithmatex">\(R_2\)</span> is a foreign key referencing <span class="arithmatex">\(K_1\)</span> in relation <span class="arithmatex">\(r_1\)</span>, if for every <span class="arithmatex">\(t_2\)</span> in <span class="arithmatex">\(r_2\)</span> there must be a tuple <span class="arithmatex">\(t_1\)</span> in <span class="arithmatex">\(r_1\)</span> such that <span class="arithmatex">\(t_1[K_1] = t_2[\alpha]\)</span>. </p>
<div class="arithmatex">\[
    \forall t_2 \in r_2, \exists t_1 \in r_1, t_1[K_1] = t_2[\alpha]
\]</div>
<p>Referential integrity constraint also called subset dependency, since its can be written as </p>
<div class="arithmatex">\[
    \Pi_{\alpha}(r_2) \subseteq \Pi_{K_1}(r_1)
\]</div>
<p>在这里<span class="arithmatex">\(r_2\)</span>是参照关系(referencing relation)，<span class="arithmatex">\(r_1\)</span>是被参照关系(referenced relation)。</p>
<p>参照关系中外码的值必须在被参照关系中实际存在，或为null. </p>
<p>For example, the following constraint ensures that the <code>branch_name</code> in the <code>employee</code> relation must match the <code>branch_name</code> in the <code>branch</code> relation:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="p">(</span><span class="n">eno</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="n">ename</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="n">job</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="n">branch_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">branch_name</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">branch</span><span class="p">(</span><span class="n">branch_name</span><span class="p">));</span>
</span></code></pre></div>
<ul>
<li>
<p>INSERT:If a tuple <span class="arithmatex">\(t_2\)</span> is inserted into <span class="arithmatex">\(r_2\)</span>, the system must ensure that there is a tuple <span class="arithmatex">\(t_1\)</span> in <span class="arithmatex">\(r_1\)</span> such that <span class="arithmatex">\(t_1[K_1] = t_2[\alpha]\)</span>, 例如如果插入一个员工，则该员工所属的branch_name必须在branch表中存在。</p>
</li>
<li>
<p>DELETE: If a tuple <span class="arithmatex">\(t_1\)</span> is deleted from <span class="arithmatex">\(r_1\)</span>, the system must compute the set of tuples in <span class="arithmatex">\(r_2\)</span> that reference <span class="arithmatex">\(t_1\)</span>:</p>
</li>
</ul>
<div class="arithmatex">\[
    \sigma_{\alpha = t_1[K_1]}(r_2)
\]</div>
<blockquote>
<p>如果r2中存在与r1中被删记录匹配的元组 </p>
</blockquote>
<p>If this set is not empty, then either the delete command is rejected as an error, or the tuples in <span class="arithmatex">\(t_2\)</span> that references <span class="arithmatex">\(t_1\)</span> must themselves be deleted (cascading deletions are possible). </p>
<p>例如如果删除了一个branch，则所有属于该branch的employee也必须被删除，或者这个删除操作被拒绝。</p>
<ul>
<li>UPDATE CASE 1: If a tuple <span class="arithmatex">\(t_2\)</span> is updated in relation <span class="arithmatex">\(r_2\)</span> and the update modifies values for foreign key <span class="arithmatex">\(\alpha\)</span>, then a test similar to the insert case is made:</li>
</ul>
<p>Let <span class="arithmatex">\(t_2'\)</span> denote the new value of tuple <span class="arithmatex">\(t_2\)</span>. The system must ensure that </p>
<div class="arithmatex">\[
    t_2'[K_1] \in \Pi_{K_1}(r_1)
\]</div>
<p>例如如果更新一个employee的branch_name，则该employee的branch_name必须在branch表中存在。</p>
<ul>
<li>UPDATE CASE 2: If a tuple <span class="arithmatex">\(t_1\)</span> is updated in relation <span class="arithmatex">\(r_1\)</span> and the update modifies values for candidate key <span class="arithmatex">\(K\)</span>, then a test similar to the delete case is made: </li>
</ul>
<p>Either the update command is rejected as an error, or the tuples in <span class="arithmatex">\(t_2\)</span> that references <span class="arithmatex">\(t_1\)</span> must themselves be updated(cascading updates are possible). </p>
<p>例如如果更新了branch里面的branch_name，则所有属于该branch的employee的branch_name也必须被更新，或者拒绝这个更新操作。</p>
<div class="admonition key-point">
<p class="admonition-title">Referential Integrity</p>
<p>Primary, candidate keys, and foreign keys can be specified as part of the SQL create table statement: </p>
<ul>
<li>The primary key clause lists attributes that comprise the primary key. </li>
<li>The unique key clause lists attributes that comprise a candidate key. </li>
<li>The foreign key clause lists the attributes that comprise the foreign key and the name of the relation referenced by the foreign key. </li>
</ul>
<p>EG
<div class="language-sql highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="p">(</span><span class="n">eno</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="n">ename</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="n">job</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="n">branch_name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">branch_name</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">branch</span><span class="p">(</span><span class="n">branch_name</span><span class="p">),</span>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">eno</span><span class="p">),</span>
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="k">unique</span><span class="w"> </span><span class="p">(</span><span class="n">ename</span><span class="p">));</span>
</span></code></pre></div></p>
<p>By default, a foreign key references the primary key attributes of the referenced table: </p>
<p>E.g., 
<div class="language-sql highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">account</span><span class="o">-</span><span class="nb">number</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="c1">--如果不指定，则默认引用account表的primary key</span>
</span></code></pre></div></p>
<p>Short form for specifying a single column as foreign key: 
E.g., 
<div class="language-sql highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="n">account</span><span class="o">-</span><span class="nb">number</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="c1">-- 简写，指定account-number为外码</span>
</span></code></pre></div></p>
<p>Reference columns in the referenced table can be explicitly specified</p>
<p>but must be declared as primary/candidate keys: 
<div class="language-sql highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">account</span><span class="o">-</span><span class="nb">number</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="p">(</span><span class="n">account</span><span class="o">-</span><span class="nb">number</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="c1">-- 指定account-number为外码，并引用account表的account-number，也可以使用不同的名字，例如</span>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a>
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">account</span><span class="o">-</span><span class="nb">number</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="p">(</span><span class="n">acnum</span><span class="p">)</span><span class="w"> </span>
</span></code></pre></div></p>
</div>
<div class="admonition info">
<p class="admonition-title">Cascading actions</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="w">        </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="k">foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">references</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span>
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="w">    </span><span class="p">[</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="k">cascade</span><span class="p">]</span><span class="w"> </span>
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="w">    </span><span class="p">[</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="k">cascade</span><span class="w"> </span><span class="p">]</span><span class="w"> </span>
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a><span class="w">    </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">);</span><span class="w"> </span>
</span></code></pre></div>
<p>加了on delete cascade，如果branch表中删除了一个元组，则account表中所有引用该branch的元组也会被删除。</p>
<p>加了on update cascade，如果branch表中更新了一个元组的branch-name，则account表中所有引用该branch的元组也会被更新。</p>
<p>如果在多个关系之间存在一系列的外键依赖关系，并且每个依赖关系都指定了on delete cascade，那么在链的一端进行的删除或更新操作可以传播到整个链。</p>
<p>但是，如果级联更新或删除导致了一个无法通过进一步级联操作来处理的约束违反，系统将会中止该事务。</p>
<p>As a result, all the changes caused by the transaction and its cascading actions are undone. </p>
<p>在 SQL 中，外键约束用于维护表之间的参照完整性。除了级联删除（<code>ON DELETE CASCADE</code>）之外，还有其他选项可以在删除被引用的记录时指定外键的行为：</p>
<ol>
<li>
<p><strong><code>ON DELETE SET NULL</code></strong> : 当被引用的记录被删除时，将外键列的值设置为 <code>NULL</code>。这意味着如果一个记录在被引用的表中被删除，那么在引用表中所有引用该记录的外键列将被设置为 <code>NULL</code>。</p>
</li>
<li>
<p><strong><code>ON DELETE SET DEFAULT</code></strong> : 当被引用的记录被删除时，将外键列的值设置为一个默认值。这个默认值必须在创建表时定义。</p>
</li>
</ol>
<p>关于外键属性中的空值（<code>NULL</code>）：</p>
<ul>
<li>如果外键的任何属性为 <code>NULL</code>，则该元组被定义为满足外键约束。这是因为 <code>NULL</code> 表示未知或不适用，因此 SQL 允许外键列包含 <code>NULL</code> 值，而不违反参照完整性。</li>
</ul>
<p>然而，外键属性中的 <code>NULL</code> 值会使 SQL 的参照完整性语义变得复杂。因此，通常建议使用 <code>NOT NULL</code> 约束来防止外键属性中出现 <code>NULL</code> 值，以确保数据的一致性和完整性。</p>
<p>例如：</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="w">    </span><span class="n">order_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="w">    </span><span class="n">customer_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">customers</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a><span class="p">);</span>
</span></code></pre></div>
<p>在这个例子中，如果 <code>customers</code> 表中的某个 <code>id</code> 被删除，那么 <code>orders</code> 表中所有引用该 <code>id</code> 的 <code>customer_id</code> 列将被设置为 <code>NULL</code>。</p>
</div>
<div class="admonition idea">
<p class="admonition-title">Idea</p>
<p>参照完整性只在事务结束时才会被检查</p>
<p>也就是说：在事务执行过程中的中间步骤允许违反参照完整性，只要在事务结束时这些违反被消除即可。</p>
<p>否则，某些数据库状态将无法创建，例如：插入两个相互引用的元组（它们的外键互相指向对方）</p>
</div>
<h4 id="assertions">Assertions<a class="headerlink" href="#assertions" title="Permanent link">&para;</a></h4>
<p>An assertion is a predicate expressing a condition that we wish the database always to satisfy. --- for complex check condition on several relations! </p>
<p>Format:
<div class="language-sql highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">assertion</span><span class="w"> </span><span class="k">constraint_name</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span><span class="p">;</span>
</span></code></pre></div></p>
<p>When an assertion is made, the system tests it for validity on every update that may violate the assertion. (when the predicate is true, it is Ok, otherwise report error.) </p>
<p>这种测试可能会带来大量的系统开销；因此，断言应该谨慎使用。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>if we require "the sum of all loan amounts for each branch must be less than the sum of all account balances at the branch". </p>
<p>But SQL does not provide a construct for asserting: 
<div class="language-sql highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="k">for</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span>
</span></code></pre></div>
So it is achieved in a round-about fashion, using: </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">P</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w">  </span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">ASSERTION</span><span class="w"> </span><span class="k">sum</span><span class="o">-</span><span class="k">constraint</span><span class="w"> </span><span class="k">CHECK</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="w">    </span><span class="p">(</span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="n">B</span>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span>
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">loan</span>
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">loan</span><span class="p">.</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="w">    </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="w">      </span><span class="p">)</span>
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="w">    </span><span class="p">);</span>
</span></code></pre></div>
</div>
<h4 id="triggers">Triggers<a class="headerlink" href="#triggers" title="Permanent link">&para;</a></h4>
<p>A trigger is a statement that is executed automatically by the system as a side-effect of a modification to the database. </p>
<p>To design a trigger mechanism, we must: </p>
<ol>
<li>Specify the conditions under which the trigger is to be executed. </li>
<li>Specify the actions to be taken when the trigger executes. </li>
</ol>
<blockquote>
<p>Triggers were introduced to SQL standard in SQL:1999, but supported even earlier using non-standard syntax by most databases. </p>
</blockquote>
<p>Format:
<div class="language-sql highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">trigger</span><span class="w"> </span><span class="k">trigger_name</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="err">{</span><span class="k">before</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">after</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="k">insert</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">update</span><span class="err">}</span><span class="w"> </span><span class="p">[</span><span class="k">of</span><span class="w"> </span><span class="n">attribute_name</span><span class="p">]</span>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="k">on</span><span class="w"> </span><span class="n">relation_name</span>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="p">[</span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="k">row</span><span class="p">]</span>
</span><span id="__span-123-5"><a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="p">[</span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">condition</span><span class="p">)]</span>
</span><span id="__span-123-6"><a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a><span class="k">begin</span>
</span><span id="__span-123-7"><a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">action</span><span class="o">&gt;</span>
</span><span id="__span-123-8"><a id="__codelineno-123-8" name="__codelineno-123-8" href="#__codelineno-123-8"></a><span class="k">end</span><span class="p">;</span>
</span></code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>触发器可以限制在特定属性的更新上：
例如：
<div class="language-sql highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">trigger</span><span class="w"> </span><span class="n">overdraft</span><span class="o">-</span><span class="k">trigger</span><span class="w"> </span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="w">            </span><span class="k">after</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="err">…</span><span class="w"> </span>
</span></code></pre></div></p>
<p>更新前后的属性值可以被引用：
Referencing old row as：用于删除和更新操作
Referencing new row as：用于插入和更新操作</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Suppose that instead of allowing negative account balances, the bank deals with overdrafts by (the actions): </p>
<ul>
<li>Setting the account balance to zero </li>
<li>Creating a loan in the amount of the overdraft, giving this loan a loan number identical to the account number of the overdrawn account </li>
</ul>
<p>The condition for executing the trigger is an update to the account relation that results in a negative balance value. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">overdraft</span><span class="o">-</span><span class="k">trigger</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">account</span><span class="w"> </span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="w">    </span><span class="k">referencing</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="k">row</span><span class="w"> </span>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="w">    </span><span class="k">when</span><span class="w"> </span><span class="n">nrow</span><span class="p">.</span><span class="n">balance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="k">begin</span><span class="w"> </span><span class="k">atomic</span><span class="w"> </span>
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="w">    </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">borrower</span><span class="w"> </span>
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a><span class="w">        </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span><span class="w"> </span><span class="n">account_number</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span>
</span><span id="__span-125-8"><a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="n">nrow</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">depositor</span><span class="p">.</span><span class="n">account_number</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-125-9"><a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a><span class="w">    </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="k">values</span><span class="w"> </span>
</span><span id="__span-125-10"><a id="__codelineno-125-10" name="__codelineno-125-10" href="#__codelineno-125-10"></a><span class="w">        </span><span class="p">(</span><span class="n">nrow</span><span class="p">.</span><span class="n">account_number</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">.</span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">nrow</span><span class="p">.</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-125-11"><a id="__codelineno-125-11" name="__codelineno-125-11" href="#__codelineno-125-11"></a><span class="w">    </span><span class="k">update</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
</span><span id="__span-125-12"><a id="__codelineno-125-12" name="__codelineno-125-12" href="#__codelineno-125-12"></a><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span>
</span><span id="__span-125-13"><a id="__codelineno-125-13" name="__codelineno-125-13" href="#__codelineno-125-13"></a><span class="k">end</span><span class="w"> </span>
</span></code></pre></div>
</div>
<div class="admonition info">
<p class="admonition-title">Statement Level Triggers</p>
<p>Instead of executing a separate action for each affected row, a single action can be executed for all rows affected by a transaction. </p>
<ul>
<li>Use for each statement instead of for each row </li>
<li>Use referencing old table or referencing new table to refer to temporary tables  (called transition tables) containing the affected rows </li>
<li>Can be more efficient when dealing with SQL statements that update a large number of rows </li>
</ul>
<p>当然，这里有一个使用语句级触发器的示例。假设我们有一个 <code>orders</code> 表，我们希望在更新订单状态时记录所有受影响订单的日志。</p>
<p>表结构</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="w">    </span><span class="n">order_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="w">    </span><span class="n">order_status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="w">    </span><span class="n">last_updated</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a><span class="p">);</span>
</span><span id="__span-126-6"><a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a>
</span><span id="__span-126-7"><a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">order_log</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-126-8"><a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a><span class="w">    </span><span class="n">log_id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-126-9"><a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a><span class="w">    </span><span class="n">order_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span>
</span><span id="__span-126-10"><a id="__codelineno-126-10" name="__codelineno-126-10" href="#__codelineno-126-10"></a><span class="w">    </span><span class="n">old_status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
</span><span id="__span-126-11"><a id="__codelineno-126-11" name="__codelineno-126-11" href="#__codelineno-126-11"></a><span class="w">    </span><span class="n">new_status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
</span><span id="__span-126-12"><a id="__codelineno-126-12" name="__codelineno-126-12" href="#__codelineno-126-12"></a><span class="w">    </span><span class="n">change_time</span><span class="w"> </span><span class="k">TIMESTAMP</span>
</span><span id="__span-126-13"><a id="__codelineno-126-13" name="__codelineno-126-13" href="#__codelineno-126-13"></a><span class="p">);</span>
</span></code></pre></div>
<p>语句级触发器</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">log_order_status_change</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="k">AFTER</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="n">order_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span>
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="k">REFERENCING</span><span class="w"> </span><span class="k">OLD</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">old_orders</span><span class="w"> </span><span class="k">NEW</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">new_orders</span>
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="k">FOR</span><span class="w"> </span><span class="k">EACH</span><span class="w"> </span><span class="k">STATEMENT</span>
</span><span id="__span-127-5"><a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a><span class="k">BEGIN</span>
</span><span id="__span-127-6"><a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a><span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">order_log</span><span class="w"> </span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">old_status</span><span class="p">,</span><span class="w"> </span><span class="n">new_status</span><span class="p">,</span><span class="w"> </span><span class="n">change_time</span><span class="p">)</span>
</span><span id="__span-127-7"><a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">old_orders</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w"> </span><span class="n">old_orders</span><span class="p">.</span><span class="n">order_status</span><span class="p">,</span><span class="w"> </span><span class="n">new_orders</span><span class="p">.</span><span class="n">order_status</span><span class="p">,</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span>
</span><span id="__span-127-8"><a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">old_orders</span><span class="p">,</span><span class="w"> </span><span class="n">new_orders</span>
</span><span id="__span-127-9"><a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">old_orders</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_orders</span><span class="p">.</span><span class="n">order_id</span><span class="p">;</span>
</span><span id="__span-127-10"><a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a><span class="k">END</span><span class="p">;</span>
</span></code></pre></div>
<p>这个触发器在 <code>orders</code> 表的 <code>order_status</code> 列更新后执行一次，将所有受影响的订单状态变化记录到 <code>order_log</code> 表中。这样可以有效地记录批量更新的变化，而不需要为每一行单独执行触发器。</p>
</div>
<div class="admonition info">
<p class="admonition-title">External World Actions</p>
<p>We sometimes require external world actions to be triggered on a database update 
E.g., Re-ordering an item whose quantity in a warehouse has become small, or turning on an alarm light. （当库存低于警戒线，增加订货或报警） </p>
<p>Triggers cannot be used to directly implement external-world actions, BUT 
Triggers can be used to record actions-to-be-taken in a separate table 
Have an external process that repeatedly scans the table, carries out external-world actions and deletes action from table. </p>
<p>Suppose a warehouse has the following tables </p>
<p><code>inventory(item, level)</code>: How much of each item is in the warehouse presently </p>
<p><code>minlevel(item, level)</code>: What is the minimum desired level of each item </p>
<p><code>reorder(item, amount)</code>: What quantity should we re-order at a time </p>
<p><code>orders(item, quantity)</code>: Orders to be placed  (to be read by external process) </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">reorder</span><span class="o">-</span><span class="k">trigger</span><span class="w"> </span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="k">after</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span>
</span><span id="__span-128-3"><a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="k">referencing</span><span class="w"> </span><span class="k">old</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">orow</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span>
</span><span id="__span-128-4"><a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="k">row</span><span class="w"> </span>
</span><span id="__span-128-5"><a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a><span class="k">when</span><span class="w"> </span><span class="n">nrow</span><span class="p">.</span><span class="k">level</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">level</span><span class="w"> </span>
</span><span id="__span-128-6"><a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a><span class="w">                      </span><span class="k">from</span><span class="w"> </span><span class="n">minlevel</span><span class="w"> </span>
</span><span id="__span-128-7"><a id="__codelineno-128-7" name="__codelineno-128-7" href="#__codelineno-128-7"></a><span class="w">                      </span><span class="k">where</span><span class="w"> </span><span class="n">minlevel</span><span class="p">.</span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">.</span><span class="n">item</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-128-8"><a id="__codelineno-128-8" name="__codelineno-128-8" href="#__codelineno-128-8"></a><span class="w">               </span><span class="k">and</span><span class="w"> </span><span class="n">orow</span><span class="p">.</span><span class="k">level</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="k">level</span><span class="w"> </span>
</span><span id="__span-128-9"><a id="__codelineno-128-9" name="__codelineno-128-9" href="#__codelineno-128-9"></a><span class="w">                                </span><span class="k">from</span><span class="w"> </span><span class="n">minlevel</span><span class="w"> </span>
</span><span id="__span-128-10"><a id="__codelineno-128-10" name="__codelineno-128-10" href="#__codelineno-128-10"></a><span class="w">                                </span><span class="k">where</span><span class="w"> </span><span class="n">minlevel</span><span class="p">.</span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orow</span><span class="p">.</span><span class="n">item</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-128-11"><a id="__codelineno-128-11" name="__codelineno-128-11" href="#__codelineno-128-11"></a><span class="k">begin</span><span class="w"> </span>
</span><span id="__span-128-12"><a id="__codelineno-128-12" name="__codelineno-128-12" href="#__codelineno-128-12"></a><span class="w">    </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span>
</span><span id="__span-128-13"><a id="__codelineno-128-13" name="__codelineno-128-13" href="#__codelineno-128-13"></a><span class="w">        </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span>
</span><span id="__span-128-14"><a id="__codelineno-128-14" name="__codelineno-128-14" href="#__codelineno-128-14"></a><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">reorder</span><span class="w"> </span>
</span><span id="__span-128-15"><a id="__codelineno-128-15" name="__codelineno-128-15" href="#__codelineno-128-15"></a><span class="w">        </span><span class="k">where</span><span class="w"> </span><span class="n">reorder</span><span class="p">.</span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orow</span><span class="p">.</span><span class="n">item</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-128-16"><a id="__codelineno-128-16" name="__codelineno-128-16" href="#__codelineno-128-16"></a><span class="k">end</span><span class="w"> </span>
</span></code></pre></div>
<p>虽然这个trigger不能直接执行外部世界的操作，但是可以记录下需要执行的操作，然后由外部进程来执行。</p>
<p>这个触发器在 <code>inventory</code> 表的 <code>level</code> 列更新后执行。它会检查更新后的库存量是否低于最低期望库存量，并且更新前的库存量是否高于最低期望库存量。如果满足条件，就会在 <code>orders</code> 表中插入一条新的订单记录。这样，外部进程可以读取 <code>orders</code> 表中的记录来执行实际的订购操作。</p>
</div>
<p>触发器在早些年被用于以下任务：
维护汇总数据（例如，每个部门的总工资）
通过记录对特殊关系（称为变更或增量关系）的更改并让一个单独的进程将更改应用到副本来复制数据库。</p>
<p>现在有更好的方法来完成这些任务：
如今的数据库提供内置的物化视图功能来维护汇总数据；
数据库提供内置的复制支持。</p>
<div class="admonition summary">
<p class="admonition-title">Check vs assertion vs trigger</p>
<p>在 SQL 中，<code>CHECK</code> 约束、<code>ASSERTION</code> 和 <code>TRIGGER</code> 是用于维护数据完整性和一致性的三种不同机制。以下是它们的比较：</p>
<ul>
<li>CHECK：用于在表级别定义简单的条件，以确保列中的数据满足特定条件。限于单个表的单个列或多个列。通常性能较好，因为它们在插入或更新时直接在表级别进行检查。不能跨多个表进行复杂的条件检查。</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="w">    </span><span class="n">employee_id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="w">    </span><span class="n">salary</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>ASSERTION：用于定义跨多个表的复杂条件，以确保数据库的整体一致性。可以跨多个表进行检查。可能会影响性能，因为每次相关表更新时都需要检查断言。在许多数据库系统中不被广泛支持。</li>
</ul>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">ASSERTION</span><span class="w"> </span><span class="n">salary_check</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100000</span>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>TRIGGER：用于在特定事件（如插入、更新或删除）发生时自动执行一段代码。可以执行几乎任何类型的操作，包括调用外部程序。可能会影响性能，特别是在触发器中执行复杂逻辑时。</li>
<li>限制：在许多数据库系统中不被广泛支持。</li>
</ul>
</div>
<h3 id="authorization">Authorization<a class="headerlink" href="#authorization" title="Permanent link">&para;</a></h3>
<h4 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h4>
<p>Security involves protection from malicious attempts to steal or modify data. It can be addressed at various levels:</p>
<ul>
<li>
<p><strong>Database System Level</strong>: Authentication and authorization mechanisms allow specific users access only to required data. </p>
</li>
<li>
<p><strong>Operating System Level</strong>: Operating system super-users can do anything they want to the database! Good operating system level security is required.</p>
</li>
<li>
<p><strong>Network Level</strong>: Must use encryption to prevent:</p>
</li>
<li>Eavesdropping (unauthorized reading of messages)</li>
<li>
<p>Masquerading (pretending to be an authorized user or sending messages supposedly from authorized users)</p>
</li>
<li>
<p><strong>Physical Level</strong>: Physical access to computers allows destruction of data by intruders; traditional lock-and-key security is needed. Computers must also be protected from floods, fire, etc. -- (Recovery)</p>
</li>
<li>
<p><strong>Human Level</strong>: Users must be screened to ensure that authorized users do not give access to intruders. Users should be trained on password selection and secrecy.</p>
</li>
</ul>
<h4 id="forms-of-authorization-on-parts-of-the-database">Forms of Authorization on Parts of the Database<a class="headerlink" href="#forms-of-authorization-on-parts-of-the-database" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Read Authorization</strong>: Allows reading, but not modification of data.</li>
<li><strong>Insert Authorization</strong>: Allows insertion of new data, but not modification of existing data.</li>
<li><strong>Update Authorization</strong>: Allows modification, but not deletion of data.</li>
<li><strong>Delete Authorization</strong>: Allows deletion of data.</li>
</ul>
<h4 id="forms-of-authorization-to-modify-the-database-schema">Forms of Authorization to Modify the Database Schema<a class="headerlink" href="#forms-of-authorization-to-modify-the-database-schema" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Index Authorization</strong>: Allows creation and deletion of indices.</li>
<li><strong>Resources Authorization</strong>: Allows creation of new relations.</li>
<li><strong>Alteration Authorization</strong>: Allows addition or modifying of attributes in a relation.</li>
<li><strong>Drop Authorization</strong>: Allows deletion of relations.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Users can be given authorization on views, without being given any authorization on the relations used in the view definition. </p>
<p>Ability of views to hide data serves both to simplify usage of the system and to enhance security by allowing users access only to data they need for their job. </p>
<p>A combination of relational-level security and view-level security can be used to limit a user's access to precisely  the data that user needs. </p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Suppose a bank clerk needs to know the names of the customers of each branch, but is not authorized to see specific loan information. </p>
<p>Approach: Deny direct access to the loan relation, but grant access to the view cust-loan, which consists only of  the names of customers and the branches at which they have a loan. 
The cust-loan view is defined in SQL as follows: </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">cust</span><span class="o">-</span><span class="n">loan</span><span class="w"> </span><span class="k">as</span><span class="w"> </span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">branchname</span><span class="p">,</span><span class="w"> </span><span class="n">customer</span><span class="o">-</span><span class="n">name</span><span class="w"> </span>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">borrower</span><span class="p">,</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span>
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">borrower</span><span class="p">.</span><span class="n">loan</span><span class="o">-</span><span class="nb">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loan</span><span class="p">.</span><span class="n">loan</span><span class="o">-</span><span class="nb">number</span><span class="w"> </span>
</span></code></pre></div>
<p>The clerk can now read the cust-loan view, which will give him the information he needs without seeing the loan relation. </p>
<p>Creation of view does not require resources authorization since no real relation is being created. </p>
<p>the creator of a view gets only those privileges that provide no additional authorization beyond that he already had. </p>
</div>
<h4 id="granting-of-privileges">Granting of Privileges<a class="headerlink" href="#granting-of-privileges" title="Permanent link">&para;</a></h4>
<figure>
    <img src="../img/sql-2.png" alt="grant" width="500">
    <figcaption>Authorization Graph</figcaption>
</figure>

<p>该图的节点是用户。图的根节点是数据库管理员。
考虑对贷款进行更新授权的图。</p>
<p>一个边 <span class="arithmatex">\( U_i \rightarrow U_j \)</span> 表示用户 <span class="arithmatex">\( U_i \)</span> 已将对贷款的更新授权授予用户 <span class="arithmatex">\( U_j \)</span>。</p>
<div class="admonition property">
<p class="admonition-title">Property</p>
<p>授权图中的所有边必须是从数据库管理员开始的某条路径的一部分。</p>
<ul>
<li><strong>如果数据库管理员撤销了对 U1 的授权：</strong></li>
<li>必须从 U4 撤销授权，因为 U1 不再拥有授权。</li>
<li>
<p>不必从 U5 撤销授权，因为 U5 通过 U2 还有另一条从数据库管理员到达的授权路径。</p>
</li>
<li>
<p><strong>必须防止没有从根节点路径的授权循环：</strong></p>
</li>
<li>数据库管理员授予 U7 授权</li>
<li>U7 授予 U8 授权</li>
<li>U8 授予 U7 授权</li>
<li>数据库管理员撤销了对 U7 的授权</li>
</ul>
<p>必须撤销从 U7 到 U8 和从 U8 到 U7 的授权，因为不再有从数据库管理员到 U7 或 U8 的路径。</p>
</div>
<h4 id="grant-statement">Grant Statement<a class="headerlink" href="#grant-statement" title="Permanent link">&para;</a></h4>
<p>The grant statement is used to grant privileges to users.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="k">GRANT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">privilege</span><span class="o">-</span><span class="n">list</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="o">|</span><span class="k">view</span><span class="o">&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="o">&lt;</span><span class="k">user</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">list</span><span class="o">&gt;</span>
</span></code></pre></div>
<ul>
<li>
<p><code>user name list</code>:</p>
</li>
<li>
<p>user-ids</p>
</li>
<li>public, which allows all valid users the privilege granted </li>
<li>A role </li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>1 <strong>Public</strong>（公共）：</p>
<ul>
<li>在 SQL 中，<code>public</code> 关键字用于将权限授予所有用户。当你将某个权限授予 <code>public</code> 时，意味着每个有权访问数据库的用户都可以执行指定的操作。</li>
<li>例如，如果你将某个表的 <code>SELECT</code> 权限授予 <code>public</code>，那么任何用户都可以查询该表。</li>
<li>这是使某些数据或操作普遍可访问的一种方式，而无需指定具体的用户。</li>
</ul>
<p>2 <strong>Role</strong>（角色）：</p>
<ul>
<li>SQL 中的 <code>role</code> 是一组相关权限的命名集合，可以授予用户或其他角色。角色用于简化用户权限的管理。</li>
<li>与其将相同的一组权限单独授予多个用户，不如创建一个包含这些权限的角色，然后将该角色授予用户。</li>
<li>角色也可以授予其他角色，从而允许层次化的权限管理。</li>
<li>角色有助于更高效地组织和管理权限，特别是在拥有众多用户的大型数据库中。</li>
</ul>
</div>
<ul>
<li>
<p><code>privilege-list</code>:</p>
</li>
<li>
<p><code>SELECT</code>:allows read access to relation, or the ability to query using the view </p>
</li>
<li><code>Insert</code>: the ability to insert tuples. </li>
<li><code>Update</code>: the ability to update using the SQL update statement. </li>
<li><code>Delete</code>: the ability to delete tuples. </li>
<li><code>References</code>: ability to declare foreign keys when creating relations. </li>
<li><code>All privileges</code>: used as a short form for all the allowable privileges. </li>
<li><code>All</code>: used as a short form for all the allowable privileges. </li>
</ul>
<p>e.g.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">U1</span><span class="p">,</span><span class="n">U2</span><span class="p">,</span><span class="n">U3</span>
</span></code></pre></div>
<ul>
<li><code>WITH GRANT OPTION</code>: Allows a user who is granted a privilege to pass the privilege on to other users. </li>
</ul>
<p>e.g.</p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">U1</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">GRANT</span><span class="w"> </span><span class="k">OPTION</span>
</span></code></pre></div>
现在U1不仅有对loan表的查找权限，还可以将这个权限传递给其它的用户</p>
<h4 id="roles">Roles<a class="headerlink" href="#roles" title="Permanent link">&para;</a></h4>
<blockquote>
<p>permiting common privileges for a class of users can be specified just once, by creating a corresponding "role". </p>
</blockquote>
<p>Privileges can be granted to or revoked from roles, just like user;  roles can be assigned to users, and even to other roles. </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="k">Create</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="n">teller</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="k">Create</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="n">manager</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="k">Grant</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">teller</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a><span class="k">Grant</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">teller</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-135-5"><a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a><span class="k">Grant</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="k">privileges</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">manager</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-135-6"><a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a><span class="k">Grant</span><span class="w"> </span><span class="n">teller</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">manager</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-135-7"><a id="__codelineno-135-7" name="__codelineno-135-7" href="#__codelineno-135-7"></a><span class="k">Grant</span><span class="w"> </span><span class="n">teller</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">alice</span><span class="p">,</span><span class="w"> </span><span class="n">bob</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-135-8"><a id="__codelineno-135-8" name="__codelineno-135-8" href="#__codelineno-135-8"></a><span class="k">Grant</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avi</span><span class="p">;</span><span class="w"> </span>
</span></code></pre></div>
<h4 id="revoking-authorization">Revoking Authorization<a class="headerlink" href="#revoking-authorization" title="Permanent link">&para;</a></h4>
<p>Revoking authorization is the inverse of granting authorization. </p>
<p>The revoke statement is used to revoke authorization. </p>
<p>format</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="k">REVOKE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">privilege</span><span class="w"> </span><span class="n">list</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">view</span><span class="o">&gt;</span><span class="w"> </span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="k">user</span><span class="w"> </span><span class="n">list</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="k">restrict</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">cascade</span><span class="p">]</span><span class="w"> </span>
</span></code></pre></div>
<ul>
<li><code>&lt;privilege list&gt;</code>：要撤销的权限列表，例如 <code>SELECT</code>、<code>INSERT</code>、<code>UPDATE</code> 和<code>ALL</code>等·</li>
<li><code>&lt;table | view&gt;</code>：指定要撤销权限的表或视图。</li>
<li><code>&lt;user list&gt;</code>：指定要从中撤销权限的用户列表，pubilc表示所有用户</li>
<li><code>[restrict | cascade]</code>：指定撤销权限的方式。<ul>
<li><code>restrict</code>：如果有其他用户依赖于被撤销的权限，则不允许撤销。</li>
<li><code>cascade</code>：即使有其他用户依赖于被撤销的权限，也强制撤销，并同时撤销所有依赖的权限。</li>
</ul>
</li>
</ul>
<p>e.g.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="k">Revoke</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">U1</span><span class="p">,</span><span class="w"> </span><span class="n">U3</span><span class="w"> </span><span class="k">cascade</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="c1">--移除U1和U3在branch上的select权限，如果有依赖也一并移除</span>
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="k">Revoke</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">U1</span><span class="p">,</span><span class="w"> </span><span class="n">U3</span><span class="w"> </span><span class="k">restrict</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="c1">-- 移除U1和U3在branch上的select权限，如果有依赖就fail</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">limitations</p>
<p>SQL 不支持在元组级别进行授权。例如，我们无法通过授权限制学生只能查看（存储）自己的成绩。</p>
<p>随着 Web 访问数据库的增长，数据库访问主要来自应用程序服务器。终端用户没有数据库用户 ID，他们都被映射到同一个数据库用户 ID。</p>
<p>一个应用程序（例如 Web 应用程序）的所有终端用户可能被映射到一个单一的数据库用户。</p>
<p>在上述情况下，授权的任务由应用程序来完成，而没有 SQL 的支持。</p>
<ul>
<li><strong>好处</strong> ：应用程序可以实现细粒度的授权，例如对单个元组的授权。</li>
<li><strong>缺点</strong> ：授权必须在应用程序代码中完成，并且可能分散在整个应用程序中。由于需要阅读大量的应用程序代码，检查授权漏洞的缺失变得非常困难。</li>
</ul>
</div>
<h4 id="audit-trails">Audit Trails<a class="headerlink" href="#audit-trails" title="Permanent link">&para;</a></h4>
<p>An audit trail is a log of all changes (inserts/deletes/updates) to the database along with information such as which user performed the change, and when the change was performed. </p>
<p>Used to track erroneous/fraudulent updates. </p>
<p>Can be implemented using triggers, but many database systems provide direct support. </p>
<p>语句审计: </p>
<p>E.g., audit table by scott by access whenever successful ---- 审计用户scott每次成功地执行有关table的语句 (create table, drop table, alter table)。 </p>
<p>格式：</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="n">AUDIT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">st</span><span class="o">-</span><span class="n">opt</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="n">users</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">BY</span><span class="w"> </span><span class="k">SESSION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ACCESS</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">WHENEVER</span><span class="w"> </span><span class="n">SUCCESSFUL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">WHENEVER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">SUCCESSFUL</span><span class="p">]</span><span class="w"> </span>
</span></code></pre></div>
<ul>
<li>当 BY <users> 缺省，对所有用户审计。 </li>
<li>BY SESSION每次会话期间，相同类型的需审计的SQL语句仅记录一次。 </li>
<li>常用的<St-opt>：table, view, role, index, … </li>
<li>取消审计：NOAUDIT …(其余同audit语句)。 </li>
</ul>
<p>对象(实体)审计： </p>
<p>E.g., audit delete, update on student --- 审计所有用户对student表的delete和update操作。 
格式：</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="n">AUDIT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">obj</span><span class="o">-</span><span class="n">opt</span><span class="o">&gt;</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">&lt;</span><span class="n">obj</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="p">[</span><span class="k">BY</span><span class="w"> </span><span class="k">SESSION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">ACCESS</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="k">WHENEVER</span><span class="w"> </span><span class="n">SUCCESSFUL</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">WHENEVER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">SUCCESSFUL</span><span class="p">]</span><span class="w"> </span>
</span></code></pre></div>
<ul>
<li>obj-opt: insert, delete, update, select, grant, … </li>
<li>实体审计对所有的用户起作用。 </li>
<li>ON <obj> 指出审计对象表、视图名。 </li>
<li>ON DEFAULT 对其后创建的所有对象起作用。 </li>
<li>取消审计：NOAUDIT … </li>
</ul>
<p>怎样看审计结果： 
审计结果记录在数据字典表: sys.aud$中，也可从dba_audit_trail, dba_audit_statement, dba_audit_object中获得有关情况。 
上述数据字典表需在DBA用户（system）下才可见。 </p>
<h3 id="embedded-sql">Embedded SQL<a class="headerlink" href="#embedded-sql" title="Permanent link">&para;</a></h3>
<p>SQL标准定义了在多种编程语言中嵌入SQL的方式，例如Pascal、PL/I、Fortran、C和Cobol。 </p>
<p>在其中嵌入SQL查询的语言被称为宿主语言（Host language），而在宿主语言中允许的SQL结构组成了嵌入式SQL。 </p>
<p>EXEC SQL语句用于标识嵌入式SQL请求给预处理器： </p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="k">EXEC</span><span class="w"> </span><span class="k">SQL</span><span class="w"> </span><span class="o">&lt;</span><span class="err">嵌入式</span><span class="n">SQL语句</span><span class="o">&gt;</span><span class="w"> </span><span class="n">END_EXEC</span><span class="w"> </span>
</span></code></pre></div>
<p>注意：这在不同语言中有所不同，例如，Java嵌入使用# </p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="err">#</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">…</span><span class="p">.</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
</span></code></pre></div>
<h4 id="select">SELECT<a class="headerlink" href="#select" title="Permanent link">&para;</a></h4>
<ul>
<li>单行查询</li>
</ul>
<div class="language-c highlight"><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">BEGIN</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">V_an</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span><span class="w"> </span><span class="n">bn</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span><span class="w"> </span>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="kt">float</span><span class="w">  </span><span class="n">bal</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a><span class="err">……</span><span class="p">.</span><span class="w"> </span>
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6" href="#__codelineno-142-6"></a><span class="n">scanf</span><span class="p">(</span><span class="err">“</span><span class="o">%</span><span class="n">s</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="n">V_an</span><span class="p">);</span><span class="w">   </span><span class="c1">// 读入账号,然后据此在下面的语句获得bn, bal的值 </span>
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7" href="#__codelineno-142-7"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">SELECT</span><span class="w"> </span><span class="n">branch_name</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="o">:</span><span class="n">bn</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="n">bal</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span>
</span><span id="__span-142-8"><a id="__codelineno-142-8" name="__codelineno-142-8" href="#__codelineno-142-8"></a><span class="n">account</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">:</span><span class="n">V_an</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-142-9"><a id="__codelineno-142-9" name="__codelineno-142-9" href="#__codelineno-142-9"></a><span class="n">END_EXEC</span>
</span><span id="__span-142-10"><a id="__codelineno-142-10" name="__codelineno-142-10" href="#__codelineno-142-10"></a><span class="w">    </span><span class="nf">printf</span><span class="p">(</span><span class="err">“</span><span class="o">%</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="n">f</span><span class="err">”</span><span class="p">,</span><span class="w"> </span><span class="n">V_an</span><span class="p">,</span><span class="w"> </span><span class="n">bn</span><span class="p">,</span><span class="w"> </span><span class="n">bal</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-142-11"><a id="__codelineno-142-11" name="__codelineno-142-11" href="#__codelineno-142-11"></a><span class="err">……</span><span class="p">.</span><span class="w"> </span>
</span></code></pre></div>
<div class="language-c highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sqlca.h&gt;</span><span class="c1">  // SQL Communications Area</span>
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-143-5"><a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a><span class="w">    </span><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">BEGIN</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span>
</span><span id="__span-143-6"><a id="__codelineno-143-6" name="__codelineno-143-6" href="#__codelineno-143-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">emp_id</span><span class="p">;</span>
</span><span id="__span-143-7"><a id="__codelineno-143-7" name="__codelineno-143-7" href="#__codelineno-143-7"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">first_name</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
</span><span id="__span-143-8"><a id="__codelineno-143-8" name="__codelineno-143-8" href="#__codelineno-143-8"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">last_name</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
</span><span id="__span-143-9"><a id="__codelineno-143-9" name="__codelineno-143-9" href="#__codelineno-143-9"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">salary</span><span class="p">;</span>
</span><span id="__span-143-10"><a id="__codelineno-143-10" name="__codelineno-143-10" href="#__codelineno-143-10"></a><span class="w">    </span><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span>
</span><span id="__span-143-11"><a id="__codelineno-143-11" name="__codelineno-143-11" href="#__codelineno-143-11"></a>
</span><span id="__span-143-12"><a id="__codelineno-143-12" name="__codelineno-143-12" href="#__codelineno-143-12"></a><span class="w">    </span><span class="c1">// 读取用户输入的员工ID</span>
</span><span id="__span-143-13"><a id="__codelineno-143-13" name="__codelineno-143-13" href="#__codelineno-143-13"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter Employee ID: &quot;</span><span class="p">);</span>
</span><span id="__span-143-14"><a id="__codelineno-143-14" name="__codelineno-143-14" href="#__codelineno-143-14"></a><span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">emp_id</span><span class="p">);</span>
</span><span id="__span-143-15"><a id="__codelineno-143-15" name="__codelineno-143-15" href="#__codelineno-143-15"></a>
</span><span id="__span-143-16"><a id="__codelineno-143-16" name="__codelineno-143-16" href="#__codelineno-143-16"></a><span class="w">    </span><span class="c1">// 执行SQL查询</span>
</span><span id="__span-143-17"><a id="__codelineno-143-17" name="__codelineno-143-17" href="#__codelineno-143-17"></a><span class="w">    </span><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">SELECT</span><span class="w"> </span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="n">last_name</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span>
</span><span id="__span-143-18"><a id="__codelineno-143-18" name="__codelineno-143-18" href="#__codelineno-143-18"></a><span class="w">    </span><span class="nl">INTO</span><span class="w"> </span><span class="p">:</span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="n">last_name</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="n">salary</span>
</span><span id="__span-143-19"><a id="__codelineno-143-19" name="__codelineno-143-19" href="#__codelineno-143-19"></a><span class="w">    </span><span class="n">FROM</span><span class="w"> </span><span class="n">employees</span>
</span><span id="__span-143-20"><a id="__codelineno-143-20" name="__codelineno-143-20" href="#__codelineno-143-20"></a><span class="w">    </span><span class="n">WHERE</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">:</span><span class="n">emp_id</span><span class="p">;</span>
</span><span id="__span-143-21"><a id="__codelineno-143-21" name="__codelineno-143-21" href="#__codelineno-143-21"></a>
</span><span id="__span-143-22"><a id="__codelineno-143-22" name="__codelineno-143-22" href="#__codelineno-143-22"></a><span class="w">    </span><span class="c1">// 检查SQL执行结果</span>
</span><span id="__span-143-23"><a id="__codelineno-143-23" name="__codelineno-143-23" href="#__codelineno-143-23"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sqlca</span><span class="p">.</span><span class="n">sqlcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-143-24"><a id="__codelineno-143-24" name="__codelineno-143-24" href="#__codelineno-143-24"></a><span class="w">        </span><span class="c1">// 输出查询结果</span>
</span><span id="__span-143-25"><a id="__codelineno-143-25" name="__codelineno-143-25" href="#__codelineno-143-25"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Employee ID: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">emp_id</span><span class="p">);</span>
</span><span id="__span-143-26"><a id="__codelineno-143-26" name="__codelineno-143-26" href="#__codelineno-143-26"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;First Name: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">first_name</span><span class="p">);</span>
</span><span id="__span-143-27"><a id="__codelineno-143-27" name="__codelineno-143-27" href="#__codelineno-143-27"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Last Name: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">last_name</span><span class="p">);</span>
</span><span id="__span-143-28"><a id="__codelineno-143-28" name="__codelineno-143-28" href="#__codelineno-143-28"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Salary: %.2f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="p">);</span>
</span><span id="__span-143-29"><a id="__codelineno-143-29" name="__codelineno-143-29" href="#__codelineno-143-29"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-143-30"><a id="__codelineno-143-30" name="__codelineno-143-30" href="#__codelineno-143-30"></a><span class="w">        </span><span class="c1">// 处理错误</span>
</span><span id="__span-143-31"><a id="__codelineno-143-31" name="__codelineno-143-31" href="#__codelineno-143-31"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error: Employee not found or SQL error occurred.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-143-32"><a id="__codelineno-143-32" name="__codelineno-143-32" href="#__codelineno-143-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-143-33"><a id="__codelineno-143-33" name="__codelineno-143-33" href="#__codelineno-143-33"></a>
</span><span id="__span-143-34"><a id="__codelineno-143-34" name="__codelineno-143-34" href="#__codelineno-143-34"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-143-35"><a id="__codelineno-143-35" name="__codelineno-143-35" href="#__codelineno-143-35"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>多行查询</li>
</ul>
<p>在嵌入式SQL中，多行查询通常使用游标（Cursor）来处理。游标允许程序逐行处理查询结果集。</p>
<p>假设我们有以下三个表：<code>depositor</code>、<code>customer</code>和<code>account</code>。我们希望找到在某个账户中余额超过给定金额的客户的姓名和城市。</p>
<ul>
<li>STEP 1: 声明游标</li>
</ul>
<p>首先，声明一个游标来保存查询结果。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">BEGIN</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a><span class="kt">float</span><span class="w"> </span><span class="n">v_amount</span><span class="p">;</span>
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a><span class="kt">char</span><span class="w"> </span><span class="n">cn</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span><span class="w">  </span><span class="c1">// customer name</span>
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a><span class="kt">char</span><span class="w"> </span><span class="n">ccity</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span><span class="w">  </span><span class="c1">// customer city</span>
</span><span id="__span-144-5"><a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span>
</span><span id="__span-144-6"><a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a>
</span><span id="__span-144-7"><a id="__codelineno-144-7" name="__codelineno-144-7" href="#__codelineno-144-7"></a><span class="c1">// 声明游标</span>
</span><span id="__span-144-8"><a id="__codelineno-144-8" name="__codelineno-144-8" href="#__codelineno-144-8"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">CURSOR</span><span class="w"> </span><span class="n">FOR</span>
</span><span id="__span-144-9"><a id="__codelineno-144-9" name="__codelineno-144-9" href="#__codelineno-144-9"></a><span class="n">SELECT</span><span class="w"> </span><span class="n">customer_name</span><span class="p">,</span><span class="w"> </span><span class="n">customer_city</span>
</span><span id="__span-144-10"><a id="__codelineno-144-10" name="__codelineno-144-10" href="#__codelineno-144-10"></a><span class="n">FROM</span><span class="w"> </span><span class="n">depositor</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">A</span>
</span><span id="__span-144-11"><a id="__codelineno-144-11" name="__codelineno-144-11" href="#__codelineno-144-11"></a><span class="n">WHERE</span><span class="w"> </span><span class="n">D</span><span class="p">.</span><span class="n">customer_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">.</span><span class="n">customer_name</span>
</span><span id="__span-144-12"><a id="__codelineno-144-12" name="__codelineno-144-12" href="#__codelineno-144-12"></a><span class="w">      </span><span class="n">AND</span><span class="w"> </span><span class="n">D</span><span class="p">.</span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">account_number</span>
</span><span id="__span-144-13"><a id="__codelineno-144-13" name="__codelineno-144-13" href="#__codelineno-144-13"></a><span class="w">      </span><span class="n">AND</span><span class="w"> </span><span class="n">A</span><span class="p">.</span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="n">v_amount</span><span class="p">;</span>
</span><span id="__span-144-14"><a id="__codelineno-144-14" name="__codelineno-144-14" href="#__codelineno-144-14"></a><span class="n">END_EXEC</span>
</span></code></pre></div>
<ul>
<li>STEP 2: 打开游标</li>
</ul>
<p>使用<code>OPEN</code>语句执行查询并打开游标。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="c1">// 打开游标</span>
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">OPEN</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">END_EXEC</span><span class="p">;</span>
</span></code></pre></div>
<ul>
<li>STEP 3: 获取数据</li>
</ul>
<p>使用<code>FETCH</code>语句逐行获取查询结果，并将结果存储在宿主语言变量中。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="c1">// 获取数据</span>
</span><span id="__span-146-2"><a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-146-3"><a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="w">    </span><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">FETCH</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="o">:</span><span class="n">cn</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="n">ccity</span><span class="w"> </span><span class="n">END_EXEC</span><span class="p">;</span>
</span><span id="__span-146-4"><a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sqlca</span><span class="p">.</span><span class="n">sqlcode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// SQLSTATE &#39;02000&#39; indicates no more data</span>
</span><span id="__span-146-5"><a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-146-6"><a id="__codelineno-146-6" name="__codelineno-146-6" href="#__codelineno-146-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-146-7"><a id="__codelineno-146-7" name="__codelineno-146-7" href="#__codelineno-146-7"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Customer Name: %s, City: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cn</span><span class="p">,</span><span class="w"> </span><span class="n">ccity</span><span class="p">);</span>
</span><span id="__span-146-8"><a id="__codelineno-146-8" name="__codelineno-146-8" href="#__codelineno-146-8"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>STEP 4: 关闭游标</li>
</ul>
<p>使用<code>CLOSE</code>语句关闭游标并释放资源。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="c1">// 关闭游标</span>
</span><span id="__span-147-2"><a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">CLOSE</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">END_EXEC</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="update">Update<a class="headerlink" href="#update" title="Permanent link">&para;</a></h4>
<ul>
<li>单行修改</li>
</ul>
<p>在嵌入式SQL中，单行修改操作允许我们通过SQL语句直接更新数据库中的数据。</p>
<p>假设我们有一个<code>account</code>表，其中包含字段<code>account_number</code>和<code>balance</code>。我们希望根据用户输入的账号和存款额来更新账户余额。</p>
<p>首先，声明用于存储用户输入的账号和存款额的变量。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">BEGIN</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span>
</span><span id="__span-148-2"><a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">an</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span><span class="w">  </span><span class="c1">// account number</span>
</span><span id="__span-148-3"><a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a><span class="kt">float</span><span class="w"> </span><span class="n">bal</span><span class="p">;</span><span class="w">    </span><span class="c1">// balance to add</span>
</span><span id="__span-148-4"><a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span>
</span></code></pre></div>
<p>使用<code>scanf</code>函数读取用户输入的账号和存款额。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="c1">// 读取账号和存款额</span>
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter account number and amount to deposit: &quot;</span><span class="p">);</span>
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s %f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">an</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bal</span><span class="p">);</span>
</span></code></pre></div>
<p>使用<code>EXEC SQL UPDATE</code>语句更新数据库中的账户余额。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="c1">// 更新账户余额</span>
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">:</span><span class="n">bal</span>
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="n">WHERE</span><span class="w"> </span><span class="n">account_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">:</span><span class="n">an</span><span class="p">;</span>
</span></code></pre></div>
<ul>
<li>多行修改</li>
</ul>
<p>在嵌入式SQL中，可以通过声明游标为可更新（<code>FOR UPDATE</code>）来更新游标获取的元组。这允许在游标当前指向的记录上执行更新操作。以下是一个示例，展示如何在C语言中使用嵌入式SQL和游标来更新数据库中的数据。</p>
<p>假设我们有一个<code>account</code>表，我们希望更新<code>Perryridge</code>分行的所有账户余额，每个账户增加100。</p>
<p>首先，声明用于存储查询结果的变量，并声明一个可更新的游标。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">BEGIN</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">an</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span><span class="w">  </span><span class="c1">// account number</span>
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="kt">float</span><span class="w"> </span><span class="n">bal</span><span class="p">;</span><span class="w">    </span><span class="c1">// balance</span>
</span><span id="__span-151-4"><a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">END</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">SECTION</span><span class="p">;</span>
</span><span id="__span-151-5"><a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a>
</span><span id="__span-151-6"><a id="__codelineno-151-6" name="__codelineno-151-6" href="#__codelineno-151-6"></a><span class="c1">// 声明可更新游标</span>
</span><span id="__span-151-7"><a id="__codelineno-151-7" name="__codelineno-151-7" href="#__codelineno-151-7"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">DECLARE</span><span class="w"> </span><span class="n">csr</span><span class="w"> </span><span class="n">CURSOR</span><span class="w"> </span><span class="n">FOR</span>
</span><span id="__span-151-8"><a id="__codelineno-151-8" name="__codelineno-151-8" href="#__codelineno-151-8"></a><span class="n">SELECT</span><span class="w"> </span><span class="o">*</span>
</span><span id="__span-151-9"><a id="__codelineno-151-9" name="__codelineno-151-9" href="#__codelineno-151-9"></a><span class="n">FROM</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-151-10"><a id="__codelineno-151-10" name="__codelineno-151-10" href="#__codelineno-151-10"></a><span class="n">WHERE</span><span class="w"> </span><span class="n">branch_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Perryridge</span><span class="err">&#39;</span>
</span><span id="__span-151-11"><a id="__codelineno-151-11" name="__codelineno-151-11" href="#__codelineno-151-11"></a><span class="n">FOR</span><span class="w"> </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">balance</span><span class="p">;</span>
</span></code></pre></div>
<p>使用<code>OPEN</code>语句执行查询并打开游标。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="c1">// 打开游标</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">OPEN</span><span class="w"> </span><span class="n">csr</span><span class="p">;</span>
</span></code></pre></div>
<p>使用<code>FETCH</code>语句逐行获取查询结果，并在游标当前指向的记录上执行更新操作。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="c1">// 获取和更新数据</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="w">    </span><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">FETCH</span><span class="w"> </span><span class="n">csr</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="o">:</span><span class="n">an</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="n">bal</span><span class="p">;</span>
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sqlca</span><span class="p">.</span><span class="n">sqlcode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 检查是否成功获取数据</span>
</span><span id="__span-153-5"><a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-153-6"><a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-153-7"><a id="__codelineno-153-7" name="__codelineno-153-7" href="#__codelineno-153-7"></a><span class="w">    </span><span class="c1">// 处理数据（例如打印）</span>
</span><span id="__span-153-8"><a id="__codelineno-153-8" name="__codelineno-153-8" href="#__codelineno-153-8"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Account Number: %s, Balance: %.2f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">an</span><span class="p">,</span><span class="w"> </span><span class="n">bal</span><span class="p">);</span>
</span><span id="__span-153-9"><a id="__codelineno-153-9" name="__codelineno-153-9" href="#__codelineno-153-9"></a>
</span><span id="__span-153-10"><a id="__codelineno-153-10" name="__codelineno-153-10" href="#__codelineno-153-10"></a><span class="w">    </span><span class="c1">// 更新当前游标位置的记录</span>
</span><span id="__span-153-11"><a id="__codelineno-153-11" name="__codelineno-153-11" href="#__codelineno-153-11"></a><span class="w">    </span><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">UPDATE</span><span class="w"> </span><span class="n">account</span>
</span><span id="__span-153-12"><a id="__codelineno-153-12" name="__codelineno-153-12" href="#__codelineno-153-12"></a><span class="w">    </span><span class="n">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-153-13"><a id="__codelineno-153-13" name="__codelineno-153-13" href="#__codelineno-153-13"></a><span class="w">    </span><span class="n">WHERE</span><span class="w"> </span><span class="n">CURRENT</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">csr</span><span class="p">;</span>
</span><span id="__span-153-14"><a id="__codelineno-153-14" name="__codelineno-153-14" href="#__codelineno-153-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>使用<code>CLOSE</code>语句关闭游标并释放资源。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="c1">// 关闭游标</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">CLOSE</span><span class="w"> </span><span class="n">csr</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="dynamic-sql">Dynamic SQL<a class="headerlink" href="#dynamic-sql" title="Permanent link">&para;</a></h3>
<p>动态SQL（Dynamic SQL）允许程序在运行时构建和提交SQL查询。这种技术非常有用，因为它提供了灵活性，使程序能够根据用户输入或其他运行时条件生成SQL语句。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">sqlprog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;update account set balance = balance * 1.05 where account_number = ?&quot;</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">PREPARE</span><span class="w"> </span><span class="n">dynprog</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="o">:</span><span class="n">sqlprog</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-155-3"><a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="kt">char</span><span class="w"> </span><span class="n">v_account</span><span class="w"> </span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;A_101&quot;</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-155-4"><a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a><span class="err">……</span>
</span><span id="__span-155-5"><a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a><span class="n">EXEC</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">EXECUTE</span><span class="w"> </span><span class="n">dynprog</span><span class="w"> </span><span class="n">USING</span><span class="w"> </span><span class="o">:</span><span class="n">v_account</span><span class="p">;</span>
</span></code></pre></div>
<ul>
<li><code>char *sqlprog</code>定义了一个包含占位符?的SQL语句。占位符用于在执行时插入实际的值。</li>
<li><code>EXEC SQL PREPARE dynprog FROM :sqlprog;</code>准备动态SQL程序dynprog，将SQL语句从字符串变量sqlprog中读取。</li>
<li><code>char v_account[10] = "A_101";</code>定义了一个变量v_account，用于存储要更新的账户号码。</li>
<li><code>EXEC SQL EXECUTE dynprog USING :v_account;</code>执行准备好的SQL程序dynprog，并通过USING子句将v_account的值插入到SQL语句中的占位符位置。</li>
</ul>
<h2 id="odbc-and-jdbc">ODBC and JDBC<a class="headerlink" href="#odbc-and-jdbc" title="Permanent link">&para;</a></h2>
<p>开放数据库互连（ODBC，Open DataBase Connectivity）<br />
一种用于应用程序与数据库服务器通信的标准。<br />
通过应用程序接口（API）来：  </p>
<ul>
<li>打开与数据库的连接，</li>
<li>发送查询和更新，</li>
<li>获取结果。</li>
</ul>
<p>GUI、电子表格等应用程序可以使用 ODBC。</p>
<p>嵌入式 SQL 与 ODBC 的比较：  </p>
<ul>
<li>嵌入式 SQL：预编译器是特定于 DBMS 的。</li>
<li>ODBC 提供了一种通过 API 将数据库连接到应用程序程序员的标准化方式。</li>
<li>不特定于 DBMS。</li>
<li>不需要预编译。</li>
</ul>
<p>ODBC提供了一个公共的、与具体数据库无关的应用程序设计接口API 。它为开发者提供单一的编程接口，这样同一个应用程序就可以访问不同的数据库服务器。 </p>
<p>使用ODBC访问数据库的方法：</p>
<ul>
<li>ODBC API访问数据库 </li>
<li>Visual C++的MFC提供了丰富的ODBC类，它们封装了大量的函数用以完成数据库的大部分应用 </li>
</ul>
<p>访问数据库的其他方法: </p>
<ul>
<li>OLE DB (Object Link and Embedding DataBase) --- 是一套通过COM (Component Object Model,组件对象模型)接口访问数据库的ActiveX的底层接口技术,速度快，支持关系型和非关系型数据库，编程量大。 </li>
<li>ADO---基于COM，建立在OLE DB 之上，更易于使用. </li>
<li>DAO (Data Access Objects) </li>
</ul>
<figure>
    <img src="../img/sql-3.png" alt="ODBC Architecture">
    <figcaption>ODBC Architecture</figcaption>
</figure>

<p><strong>句柄</strong>（Handle）是一种抽象的引用，用于标识和管理系统资源。句柄通常是一个整数或指针，程序通过它来访问和操作特定的资源，而不需要直接与资源的底层实现交互。</p>
<pre class="mermaid"><code>graph TD
    A[应用程序] --&gt; B[环境句柄]
    B --&gt; C[连接句柄]
    B --&gt; D[连接句柄]
    B --&gt; E[连接句柄]
    D --&gt; F[语句句柄]
    D --&gt; G[语句句柄]
    D --&gt; H[语句句柄]</code></pre>
<ol>
<li>
<p>分配环境句柄
<div class="language-c highlight"><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="n">HENV</span><span class="w"> </span><span class="n">henv</span><span class="p">;</span>
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a><span class="n">SQLAllocEnv</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">henv</span><span class="w"> </span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p>分配连接句柄
<div class="language-c highlight"><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="n">HDBC</span><span class="w"> </span><span class="n">hdbc</span><span class="p">;</span>
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="n">SQLAllocConnect</span><span class="p">(</span><span class="n">henv</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hdbc</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
</ol>
<p>3.用已分配的连接句柄连接数据源
<div class="language-c highlight"><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="n">SQLConnect</span><span class="w"> </span><span class="p">(</span><span class="n">hdbc</span><span class="p">,</span><span class="w"> </span><span class="n">szDSN</span><span class="p">,</span><span class="w"> </span><span class="n">cbDSN</span><span class="p">,</span><span class="w"> </span><span class="n">szUID</span><span class="p">,</span><span class="w"> </span><span class="n">cbUID</span><span class="p">,</span><span class="w"> </span><span class="n">szAuthStr</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="n">cbAuthStr</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
</span></code></pre></div>
说明：<code>hdbc</code>是一个已分配的连接句柄；
<code>szDSN</code>和<code>cbDSN</code>分别表示系统所要连接的数据源名称字符串及其长度；
<code>szUID</code>和<code>cbUID</code>分别表示连接数据源的用户名字符串及其长度 
<code>szAuthStr</code>和<code>cbAuthStr</code>分别表示连接数据源的权限字符串及其长
度。</p>
<ol>
<li>
<p>分配语句句柄
<div class="language-c highlight"><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="n">HSTMT</span><span class="w"> </span><span class="n">hstmt</span><span class="p">;</span>
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a><span class="n">SQLAllocStmt</span><span class="w"> </span><span class="p">(</span><span class="n">hdbc</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hstmt</span><span class="p">);</span><span class="w"> </span>
</span></code></pre></div></p>
</li>
<li>
<p>1直接执行SQL语句
<div class="language-c highlight"><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="n">SQLExecDirect</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">hstmt</span><span class="p">,</span><span class="w"> </span><span class="n">szSqlStr</span><span class="p">,</span><span class="w"> </span><span class="n">cbSqlStr</span><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
说明：<code>hstmt</code>是一个有效的语句句柄；
<code>szSqlStr</code>和<code>cbSqlStr</code>分别表示将要执行的SQL语句的字符串及其长度。
例子：<code>retcode=SQLExecDirect(hstmt, "delete from book where ISBN=1", SQL_NTS);</code>
说明：删除book表中ISBN=1的记录。SQL_NTS是ODBC的一个常数，当字符串是以NULL结束时，可用它来表示字符串的长度。</p>
</li>
</ol>
<p>5.2有准备地执行SQL语句
如果SQL语句需要执行几次，则采用有准备的执行更好，避免了SQL语句的多次分析。有准备的执行需要两个函数。
<div class="language-c highlight"><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a><span class="n">SQLPrepare</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">hstmt</span><span class="p">,</span><span class="w"> </span><span class="n">szSqlStr</span><span class="p">,</span><span class="w"> </span><span class="n">cbSqlStr</span><span class="p">);</span>
</span></code></pre></div>
说明：SQL语句准备函数，参数同SQLExecDirect。
<div class="language-c highlight"><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="n">SQLExecute</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">hstmt</span><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
说明：SQL语句执行函数</p>
<ol>
<li>查询结果的获取
<div class="language-c highlight"><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a><span class="n">SQLFetch</span><span class="p">(</span><span class="n">hstmt</span><span class="p">);</span>
</span></code></pre></div>
说明：把游标移到下一行，当查询语句执行后第一次调用时移到结果集的第一行。
<div class="language-c highlight"><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="n">SQLGetData</span><span class="p">(</span><span class="n">hstmt</span><span class="p">,</span><span class="w"> </span><span class="n">icol</span><span class="p">,</span><span class="w"> </span><span class="n">fCType</span><span class="p">,</span><span class="w"> </span><span class="n">rgbValue</span><span class="p">,</span><span class="w"> </span><span class="n">cbValueMax</span><span class="p">,</span><span class="w"> </span><span class="n">pcbValue</span><span class="p">);</span>
</span></code></pre></div>
说明：读取游标指向行的列值。
icol和fCType分别表示结果集的列号和类型；
rgbValue和cbValueMax是接收数据存储区的指针和最大长度；
pcbValue是返回参数，表示本次调用后实际接收到的数据的字节数。</li>
</ol>
<p>7.释放语句句柄
<div class="language-c highlight"><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="n">SQLfreeStmt</span><span class="p">(</span><span class="n">hstmt</span><span class="p">,</span><span class="w"> </span><span class="n">foption</span><span class="p">);</span>
</span></code></pre></div>
说明：<code>foption</code>指定选项，一个选项是用<code>SQL_DROP</code>表示释放所有与该句 
柄相关的资源。</p>
<p>8.断开数据源连接
<div class="language-c highlight"><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a><span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">hdbc</span><span class="p">);</span>
</span></code></pre></div>
9.释放连接句柄
<div class="language-c highlight"><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">hdbc</span><span class="p">);</span><span class="w">   </span>
</span></code></pre></div></p>
<p>10.释放环境句柄
<div class="language-c highlight"><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a><span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">henv</span><span class="p">);</span><span class="w"> </span>
</span></code></pre></div></p>
<figure>
    <img src="../img/sql-4.png" alt="ODBC Architecture">
    <figcaption>ODBC 编程流程</figcaption>
</figure>

<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">ODBCexample</span><span class="p">()</span><span class="w">   </span><span class="c1">// 程序结构 </span>
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a><span class="p">{</span><span class="w"> </span>
</span><span id="__span-169-3"><a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a><span class="w">   </span><span class="n">RETCODE</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-169-4"><a id="__codelineno-169-4" name="__codelineno-169-4" href="#__codelineno-169-4"></a><span class="w">   </span><span class="n">HENV</span><span class="w"> </span><span class="n">env</span><span class="p">;</span><span class="w">   </span><span class="cm">/* environment */</span><span class="w"> </span>
</span><span id="__span-169-5"><a id="__codelineno-169-5" name="__codelineno-169-5" href="#__codelineno-169-5"></a><span class="w">   </span><span class="n">HDBC</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span><span class="w">   </span><span class="cm">/* database connection */</span><span class="w"> </span>
</span><span id="__span-169-6"><a id="__codelineno-169-6" name="__codelineno-169-6" href="#__codelineno-169-6"></a><span class="w">   </span><span class="n">SQLAllocEnv</span><span class="p">(</span><span class="o">&amp;</span><span class="n">env</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-169-7"><a id="__codelineno-169-7" name="__codelineno-169-7" href="#__codelineno-169-7"></a><span class="w">   </span><span class="n">SQLAllocConnect</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">conn</span><span class="p">);</span><span class="w">   </span><span class="cm">/* 建立连接句柄 */</span><span class="w"> </span>
</span><span id="__span-169-8"><a id="__codelineno-169-8" name="__codelineno-169-8" href="#__codelineno-169-8"></a><span class="w">   </span><span class="n">SQLConnect</span><span class="w"> </span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MySQLServer&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SQL_NTS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SQL_NTS</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;password&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SQL_NTS</span><span class="p">);</span><span class="w">  </span><span class="cm">/* 建立用户user与数据源的连接，SQL_NTS表示前一参量以null结尾 */</span><span class="w"> </span>
</span><span id="__span-169-9"><a id="__codelineno-169-9" name="__codelineno-169-9" href="#__codelineno-169-9"></a>
</span><span id="__span-169-10"><a id="__codelineno-169-10" name="__codelineno-169-10" href="#__codelineno-169-10"></a><span class="w">   </span><span class="kt">char</span><span class="w"> </span><span class="n">branchname</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span><span class="w"> </span>
</span><span id="__span-169-11"><a id="__codelineno-169-11" name="__codelineno-169-11" href="#__codelineno-169-11"></a><span class="w">   </span><span class="kt">float</span><span class="w"> </span><span class="n">balance</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-169-12"><a id="__codelineno-169-12" name="__codelineno-169-12" href="#__codelineno-169-12"></a><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">lenOut1</span><span class="p">,</span><span class="w"> </span><span class="n">lenOut2</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-169-13"><a id="__codelineno-169-13" name="__codelineno-169-13" href="#__codelineno-169-13"></a><span class="w">   </span><span class="n">HSTMT</span><span class="w"> </span><span class="n">stmt</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-169-14"><a id="__codelineno-169-14" name="__codelineno-169-14" href="#__codelineno-169-14"></a>
</span><span id="__span-169-15"><a id="__codelineno-169-15" name="__codelineno-169-15" href="#__codelineno-169-15"></a><span class="w">   </span><span class="n">SQLAllocStmt</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stmt</span><span class="p">);</span><span class="w">   </span><span class="cm">/* 为该连接建立数据区，将来存放查询结果 */</span><span class="w"> </span>
</span><span id="__span-169-16"><a id="__codelineno-169-16" name="__codelineno-169-16" href="#__codelineno-169-16"></a><span class="w">   </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">sqlquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;select branch_name, sum(balance) from account group by branch_name&quot;</span><span class="p">;</span><span class="w">   </span><span class="cm">/* 装配SQL语句 */</span><span class="w"> </span>
</span><span id="__span-169-17"><a id="__codelineno-169-17" name="__codelineno-169-17" href="#__codelineno-169-17"></a><span class="w">   </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SQLExecDirect</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span><span class="w"> </span><span class="n">sqlquery</span><span class="p">,</span><span class="w"> </span><span class="n">SQL_NTS</span><span class="p">);</span><span class="w"> </span><span class="cm">/* 执行sql语句,查询结果存放到数据区stmt，同时sql语句执行状态的返回值送变量error */</span><span class="w"> </span>
</span><span id="__span-169-18"><a id="__codelineno-169-18" name="__codelineno-169-18" href="#__codelineno-169-18"></a>
</span><span id="__span-169-19"><a id="__codelineno-169-19" name="__codelineno-169-19" href="#__codelineno-169-19"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SQL_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-169-20"><a id="__codelineno-169-20" name="__codelineno-169-20" href="#__codelineno-169-20"></a><span class="w">       </span><span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">SQL_C_CHAR</span><span class="p">,</span><span class="w"> </span><span class="n">branchname</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lenOut1</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-169-21"><a id="__codelineno-169-21" name="__codelineno-169-21" href="#__codelineno-169-21"></a><span class="w">       </span><span class="n">SQLBindCol</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">SQL_C_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">balance</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lenOut2</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-169-22"><a id="__codelineno-169-22" name="__codelineno-169-22" href="#__codelineno-169-22"></a><span class="w">       </span><span class="cm">/* 对stmt中的返回结果数据加以分离，并与相应变量绑定。第1项数据转换为C的字符类型，送变量branchname(最大长度为80)，lenOut1为实际字符串长度（若＝-1代表null），第2项数据转换为C的浮点类型送变量balance中 */</span><span class="w"> </span>
</span><span id="__span-169-23"><a id="__codelineno-169-23" name="__codelineno-169-23" href="#__codelineno-169-23"></a>
</span><span id="__span-169-24"><a id="__codelineno-169-24" name="__codelineno-169-24" href="#__codelineno-169-24"></a><span class="w">       </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">SQLFetch</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">SQL_SUCCESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* 逐行从数据区stmt中取数据，放到绑定变量中 */</span><span class="w"> </span>
</span><span id="__span-169-25"><a id="__codelineno-169-25" name="__codelineno-169-25" href="#__codelineno-169-25"></a><span class="w">           </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s  %.2f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">branchname</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-169-26"><a id="__codelineno-169-26" name="__codelineno-169-26" href="#__codelineno-169-26"></a><span class="w">           </span><span class="cm">/* 对取出的数据进行处理 */</span><span class="w"> </span>
</span><span id="__span-169-27"><a id="__codelineno-169-27" name="__codelineno-169-27" href="#__codelineno-169-27"></a><span class="w">       </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-169-28"><a id="__codelineno-169-28" name="__codelineno-169-28" href="#__codelineno-169-28"></a><span class="w">   </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-169-29"><a id="__codelineno-169-29" name="__codelineno-169-29" href="#__codelineno-169-29"></a>
</span><span id="__span-169-30"><a id="__codelineno-169-30" name="__codelineno-169-30" href="#__codelineno-169-30"></a><span class="w">   </span><span class="n">SQLFreeStmt</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span><span class="w"> </span><span class="n">SQL_DROP</span><span class="p">);</span><span class="w">  </span><span class="cm">/* 释放数据区 */</span><span class="w"> </span>
</span><span id="__span-169-31"><a id="__codelineno-169-31" name="__codelineno-169-31" href="#__codelineno-169-31"></a><span class="w">   </span><span class="n">SQLDisconnect</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-169-32"><a id="__codelineno-169-32" name="__codelineno-169-32" href="#__codelineno-169-32"></a><span class="w">   </span><span class="n">SQLFreeConnect</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-169-33"><a id="__codelineno-169-33" name="__codelineno-169-33" href="#__codelineno-169-33"></a><span class="w">   </span><span class="n">SQLFreeEnv</span><span class="p">(</span><span class="n">env</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-169-34"><a id="__codelineno-169-34" name="__codelineno-169-34" href="#__codelineno-169-34"></a><span class="p">}</span>
</span></code></pre></div>
</div>
<p>JDBC（Java Database Connectivity）是Java语言中用于连接和操作数据库的API。它提供了一种标准的方法，使Java应用程序能够与各种数据库进行交互。JDBC允许开发者执行SQL语句、检索和更新数据库中的数据。</p>







  
  



  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="对您有帮助的话，给我一个star吧！" data-md-value="5">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M316.9 18c-5.3-11-16.5-18-28.8-18s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329l-24.6 145.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329l104.2-103.1c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7l-143.7-21.2z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="你想请我喝杯咖啡吗？" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M88 0C74.7 0 64 10.7 64 24c0 38.9 23.4 59.4 39.1 73.1l1.1 1c16.3 14.2 23.8 21.8 23.8 37.9 0 13.3 10.7 24 24 24s24-10.7 24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C119.5 47.7 112 40.1 112 24c0-13.3-10.7-24-24-24M32 192c-17.7 0-32 14.3-32 32v192c0 53 43 96 96 96h192c53 0 96-43 96-96h16c61.9 0 112-50.1 112-112s-50.1-112-112-112H32m352 64h16c26.5 0 48 21.5 48 48s-21.5 48-48 48h-16zM224 24c0-13.3-10.7-24-24-24s-24 10.7-24 24c0 38.9 23.4 59.4 39.1 73.1l1.1 1c16.3 14.2 23.8 21.8 23.8 37.9 0 13.3 10.7 24 24 24s24-10.7 24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C231.5 47.7 224 40.1 224 24"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="5" hidden>
              
              
                
              
              
              
                
                
              
              <a href="https://github.com/kailqq/kailqq.github.io">
  <div class="button"  target="_blank">Give me a star⭐</div>
</a>
            </div>
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              <div align="center"> <img src="/static/images/pay.png" width="200" height="200" /> </div>
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


<!-- Insert Giscus generated snippet here -->
<!-- 插入 Giscus 生成的代码块 -->
<script src="https://giscus.app/client.js"
data-repo="kailqq/kailqq.github.io"
data-repo-id="R_kgDOMPtz7Q"
data-category="Announcements"
data-category-id="DIC_kwDOMPtz7c4Cge_P"
data-mapping="pathname"
data-strict="0"
data-reactions-enabled="1"
data-emit-metadata="0"
data-input-position="bottom"
data-theme="preferred_color_scheme"
data-lang="zh-CN"
crossorigin="anonymous"
async>
</script>

<!-- 下面保持不动即可 -->
<!-- Synchronize Giscus theme with palette -->
<script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        giscus.setAttribute("data-theme", theme)
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function () {
        var ref = document.querySelector("[data-md-component=palette]")
        ref.addEventListener("change", function () {
            var palette = __md_get("__palette")
            if (palette && typeof palette.color === "object") {
                var theme = palette.color.scheme === "slate" ? "dark" : "light"

                /* Instruct Giscus to change theme */
                var frame = document.querySelector(".giscus-frame")
                frame.contentWindow.postMessage(
                    { giscus: { setConfig: { theme } } },
                    "https://giscus.app"
                )
            }
        })
    })
</script>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../lec2/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 关系模型">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                关系模型
              </div>
            </div>
          </a>
        
        
          
          <a href="../ER/" class="md-footer__link md-footer__link--next" aria-label="下一页: ER模型">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                ER模型
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 ~ now |  Kailqq
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/kailqq" target="_blank" rel="noopener" title="My GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="tencent://message/?uin=2725913404&Site=Kailqq&Menu=yes" target="_blank" rel="noopener" title="QQ" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741 0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792 0 0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704"/></svg>
    </a>
  
    
    
    
    
    <a href="https://steamcommunity.com/profiles/76561199513750344" target="_blank" rel="noopener" title="Steam" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256M155.7 384.3l-30.5-12.6a52.8 52.8 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3S206 305.6 193 300.2c-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21m173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3m.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": {"Default": "default-tag", "Hardware": "hardware-tag", "Software": "software-tag"}, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../../../js/print-site.js"></script>
      
        <script src="../../../javascripts/katex.js"></script>
      
        <script src="../../../javascripts/katex.min.js"></script>
      
        <script src="../../../javascripts/auto-render.min.js"></script>
      
        <script src="../../../javascripts/card.js"></script>
      
        <script src="../../../javascripts/toc.js"></script>
      
    
  </body>
</html>